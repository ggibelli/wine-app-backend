(this["webpackJsonpwine-app-frontend"]=this["webpackJsonpwine-app-frontend"]||[]).push([[8],{485:function(e,t,n){"use strict";var i=n(55),a=n(56);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=a(n(1)),r=(0,i(n(57)).default)(o.createElement("path",{d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore");t.default=r},486:function(e,t,n){"use strict";n.d(t,"a",(function(){return b}));var i=n(3),a=n(21),o=n(32),r=n(1),s=n(485),l=n.n(s),c=n(141),d=n(256),u=n(410),v=Object(c.a)((function(){return Object(d.a)({root:{display:"flex",flexDirection:"column",alignItems:"center"}})})),b=function(e){var t=v(),n="messaggi"===Object(o.d)().pathname.split("/")[1],s=function(e){var t=e.root,n=void 0===t?null:t,i=e.rootMargin,o=void 0===i?"0px":i,s=e.threshold,l=void 0===s?0:s,c=r.useState(null),d=Object(a.a)(c,2),u=d[0],v=d[1],b=r.useState(null),j=Object(a.a)(b,2),g=j[0],f=j[1],h=r.useRef(null);return r.useEffect((function(){h.current&&h.current.disconnect(),h.current=new window.IntersectionObserver((function(e){var t=Object(a.a)(e,1)[0];return v(t)}),{root:n,rootMargin:o,threshold:l});var e=h.current;return g&&e.observe(g),function(){return e.disconnect()}}),[g,n,o,l]),[f,u]}({threshold:0}),c=Object(a.a)(s,2),d=c[0],b=c[1],j=r.useState(!0),g=Object(a.a)(j,2),f=g[0],h=g[1];return r.useEffect((function(){b&&(null===b||void 0===b?void 0:b.intersectionRatio)>0&&f?(e.fetchMore(),e.setIsLoading&&e.setIsLoading(!0),h(!1)):0!==(null===b||void 0===b?void 0:b.intersectionRatio)||f||(h(!0),e.setIsLoading&&e.setIsLoading(!1))}),[null===b||void 0===b?void 0:b.intersectionRatio]),n?Object(i.jsxs)(i.Fragment,{children:[e.isVisible?e.isLoading?Object(i.jsx)("div",{className:t.root,children:Object(i.jsx)(u.a,{})}):Object(i.jsxs)("div",{className:t.root,id:"page-bottom-boundary",ref:d,children:[" ",Object(i.jsx)(l.a,{})]}):null,e.children]}):Object(i.jsxs)("div",{className:t.root,children:[e.children,e.isVisible?e.isLoading?Object(i.jsx)(u.a,{}):Object(i.jsxs)("div",{id:"page-bottom-boundary",ref:d,style:{height:30},children:[" ",Object(i.jsx)(l.a,{})]}):null]})}},488:function(e,t,n){"use strict";n.d(t,"a",(function(){return O}));var i=n(3),a=n(21),o=n(1),r=n(409),s=n(469),l=n(471),c=n(470),d=n(47),u=n.n(d),v=n(71),b=n(20),j=n(0),g=function(e){var t=e.id,n=e.handleClose,o=Object(j.O)({onCompleted:function(e){var t,n;if(null===(t=e.updateNegotiation)||void 0===t||null===(n=t.errors)||void 0===n?void 0:n.length){var i,a=null===(i=e.updateNegotiation)||void 0===i?void 0:i.errors.map((function(e){return null===e||void 0===e?void 0:e.text}));Object(b.d)({type:"error",message:"".concat(a.toString())})}else Object(b.d)({message:"trattativa chiusa con successo",type:"success"})},onError:function(e){return Object(b.d)({type:"error",message:e.message})}}),s=Object(a.a)(o,2),l=s[0],c=s[1].loading,d=function(){var e=Object(v.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n(),e.next=3,l({variables:{negotiation:{_id:t,isConcluded:!0}}});case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(i.jsx)(r.a,{"aria-label":"close-negotiation",disabled:c,onClick:d,children:"Dichiara chiusa la trattativa"})},f=n(83),h=function(e){var t=e.id,n=e.handleClose,o=Object(j.v)({onCompleted:function(e){var t,n;if(null===(t=e.deleteNegotiation)||void 0===t||null===(n=t.errors)||void 0===n?void 0:n.length){var i,a=null===(i=e.deleteNegotiation)||void 0===i?void 0:i.errors.map((function(e){return null===e||void 0===e?void 0:e.text}));Object(b.d)({type:"error",message:"".concat(a.toString())})}else Object(b.d)({message:"trattativa cancellata con successo",type:"info"})},onError:function(e){return Object(b.d)({type:"error",message:e.message})},update:function(e,t){var n,i=t.data;Object(f.g)(e,null===i||void 0===i||null===(n=i.deleteNegotiation)||void 0===n?void 0:n.response)}}),s=Object(a.a)(o,2),l=s[0],c=s[1].loading,d=function(){var e=Object(v.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n(),e.next=3,l({variables:{id:t}});case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(i.jsx)(r.a,{"aria-label":"cancel-negotiation",disabled:c,onClick:d,children:"Cancella la trattativa"})},p=n(82),O=function(e){var t=e.id,n=e.isBuy,d=e.isMessage,u=Object(p.c)(),v=o.useState(!1),b=Object(a.a)(v,2),j=b[0],f=b[1],O=function(){f(!1)};return n=!!d,Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)(r.a,{fullWidth:!0,"aria-label":"close-negotiation-popup",className:n?u.buyButton:u.sellButton,onClick:function(){f(!0)},children:"Chiudi trattativa"}),Object(i.jsx)("div",{style:{display:"none"},children:Object(i.jsxs)(s.a,{open:j,onClose:O,"aria-labelledby":"close-negotiation",children:[Object(i.jsxs)(c.a,{children:[Object(i.jsx)(h,{id:t,handleClose:O}),Object(i.jsx)(g,{id:t,handleClose:O})]}),Object(i.jsx)(l.a,{children:Object(i.jsx)(r.a,{onClick:O,color:"primary",children:"Cancel"})})]})})]})}},489:function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));var i=n(3),a=n(21),o=n(409),r=n(1),s=n(0),l=n(82),c=n(479),d=n(469),u=n(470),v=n(471),b=n(142),j=n(495),g=n(20),f=function(e){var t=e.review,n=e.disabled,r=e.closeModal,l=Object(s.t)({onCompleted:function(e){var t,n;if(null===(t=e.createReview)||void 0===t||null===(n=t.errors)||void 0===n?void 0:n.length){var i,a=null===(i=e.createReview)||void 0===i?void 0:i.errors.map((function(e){return null===e||void 0===e?void 0:e.text}));Object(g.d)({type:"error",message:"".concat(a.toString())})}else Object(g.d)({type:"success",message:"Recensione creata con successo"})},onError:function(e){return Object(g.d)({type:"error",message:e.message})}}),c=Object(a.a)(l,2),d=c[0],u=c[1].loading;return Object(i.jsx)(o.a,{disabled:n||u,"aria-label":"review",onClick:function(){r&&r(),d({variables:{review:t}})},color:"primary",children:"Recensisci"})},h={.5:"Useless",1:"Useless+",1.5:"Poor",2:"Poor+",2.5:"Ok",3:"Ok+",3.5:"Good",4:"Good+",4.5:"Excellent",5:"Excellent+"},p=function(e){var t=e.idUser,n=e.idNegotiation,g=e.type,p=e.isMessage,O=r.useState(!1),m=Object(a.a)(O,2),x=m[0],y=m[1],C=r.useState(2),w=Object(a.a)(C,2),M=w[0],N=w[1],k=r.useState(-1),S=Object(a.a)(k,2),R=S[0],L=S[1],E=r.useState(""),_=Object(a.a)(E,2),F=_[0],B=_[1],I=Object(l.c)(),P=Object(l.d)(),T=Object(l.b)(),V=function(){y(!1)};return g=p?s.k.Sell:g,Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)(o.a,{fullWidth:!0,"aria-label":"review",className:g===s.k.Buy?I.buyButton:I.sellButton,onClick:function(){y(!0)},children:"Lascia una recensione"}),Object(i.jsx)("div",{style:{display:"none"},children:Object(i.jsxs)(d.a,{open:x,onClose:V,"aria-labelledby":"form-dialog-title",children:[Object(i.jsx)(j.a,{id:"form-dialog-title",children:"Recensisci la trattativa"}),Object(i.jsxs)(u.a,{children:[Object(i.jsxs)("div",{className:T.root,children:[Object(i.jsx)(l.a,{name:"hover-feedback",value:M,precision:.5,onChange:function(e,t){N(t)},onChangeActive:function(e,t){L(t)}}),null!==M&&Object(i.jsx)(c.a,{ml:2,children:h[-1!==R?R:M]})]}),Object(i.jsx)(b.a,{color:"primary",multiline:!0,rows:4,value:F,error:F.length>0&&F.length<=5,helperText:"Lunghezza minima 5 caratteri",onChange:function(e){B(e.target.value)},InputLabelProps:{style:{color:"#6d1331"}},InputProps:{className:P.inputSell,classes:{underline:P.underlineSell}},id:"outlined-multiline-flexible",label:"Recensione",placeholder:"Ottima persona con cui...."})]}),Object(i.jsxs)(v.a,{children:[Object(i.jsx)(o.a,{"aria-label":"close-modal",onClick:V,color:"primary",children:"Cancel"}),Object(i.jsx)(f,{disabled:F.length<=5,review:{forUser:t,rating:M,negotiation:n,content:F,type:g},closeModal:V})]})]})})]})}},495:function(e,t,n){"use strict";var i=n(2),a=n(6),o=n(1),r=(n(11),n(7)),s=n(9),l=n(88),c=o.forwardRef((function(e,t){var n=e.children,s=e.classes,c=e.className,d=e.disableTypography,u=void 0!==d&&d,v=Object(a.a)(e,["children","classes","className","disableTypography"]);return o.createElement("div",Object(i.a)({className:Object(r.a)(s.root,c),ref:t},v),u?n:o.createElement(l.a,{component:"h2",variant:"h6"},n))}));t.a=Object(s.a)({root:{margin:0,padding:"16px 24px",flex:"0 0 auto"}},{name:"MuiDialogTitle"})(c)},525:function(e,t,n){"use strict";var i=n(55),a=n(56);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=a(n(1)),r=(0,i(n(57)).default)(o.createElement("path",{d:"M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"}),"Send");t.default=r},540:function(e,t,n){"use strict";n.r(t);var i=n(3),a=n(47),o=n.n(a),r=n(71),s=n(21),l=n(53),c=n(1),d=n(467),u=n(466),v=n(0),b=n(32),j=n(20),g=n(142),f=n(88),h=n(479),p=n(468),O=function(e){var t=e.message;if(!t)return null;var n=Object(j.c)(),a=t.sentBy._id===(null===n||void 0===n?void 0:n._id),o=a?12:0,r=a?0:12;return Object(i.jsx)(h.a,{"data-testid":"message-box",display:"flex",flexDirection:a?"row-reverse":"row",p:1,m:1,children:Object(i.jsxs)(h.a,{p:1,color:"white",bgcolor:a?"#6d1331":"#707070",style:{borderBottomLeftRadius:12,borderBottomRightRadius:12,borderTopRightRadius:r,borderTopLeftRadius:o},children:[Object(i.jsx)(f.a,{variant:"body1",children:t.content}),Object(i.jsx)(p.a,{container:!0,justify:"flex-end",children:Object(i.jsx)(f.a,{align:"right",variant:"caption",children:t.dateSent})})]})})},m=n(525),x=n.n(m),y=n(408),C=n(254),w=n(486),M=n(489),N=n(488),k=function(e){var t,n=e.propsMessage,a=Object(j.c)(),o=c.useState(""),r=Object(s.a)(o,2),l=r[0],d=r[1],u=c.useState(!1),v=Object(s.a)(u,2),b=v[0],f=v[1],h=c.useRef(null);c.useEffect((function(){if(h.current){if(b)return;h.current.scroll({top:document.body.offsetHeight+1e6,left:0,behavior:"smooth"})}return function(){}}),[n.messages]);var p=n.messages?n.messages[0]:null;if(!p)return null;var m=p.sentBy._id===(null===a||void 0===a?void 0:a._id)?p.sentTo._id:p.sentBy._id;return n.messages?Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)("div",{style:{height:"75vh",margin:0,padding:0,overflowY:"scroll"},ref:h,children:Object(i.jsx)(w.a,{fetchMore:n.handleFetchMore,isLoading:n.isLoading,isVisible:n.isVisible,setIsLoading:f,children:null===(t=n.messages)||void 0===t?void 0:t.map((function(e){return Object(i.jsx)(O,{message:e},null===e||void 0===e?void 0:e._id)}))})}),Object(i.jsx)("hr",{style:{borderWidth:1,borderColor:"#6d1331"}}),Object(i.jsxs)("div",{style:{height:"10vh",backgroundColor:"#fff",paddingTop:0},children:[p.negotiation.isConcluded?Object(i.jsx)(M.a,{idNegotiation:p.negotiation._id,idUser:m,isMessage:!0,type:p.negotiation.type}):Object(i.jsx)(N.a,{id:p.negotiation._id,isMessage:!0}),Object(i.jsx)(g.a,{fullWidth:!0,multiline:!0,rowsMax:2,variant:"outlined",name:"content",type:"text",placeholder:"",label:"",value:l,onChange:function(e){d(e.target.value)},inputProps:{"aria-label":"input-message"},InputProps:{endAdornment:Object(i.jsx)(y.a,{position:"end",children:Object(i.jsx)(C.a,{"aria-label":"send",disabled:!l,onClick:function(){var e={content:l,sentTo:m,negotiation:p.negotiation._id};n.handleCreate(e),d("")},children:Object(i.jsx)(x.a,{})})})}})]})]}):null},S=n(112);t.default=function(){var e,t,n,a,g,f,h,p=Object(b.e)().id,O=Object(v.C)({fetchPolicy:"network-only",variables:{id:p,offset:0,limit:20},onCompleted:function(e){var t=e.messagesForNegotiation;T(Object(l.a)(null===t||void 0===t?void 0:t.messages).reverse())}}),m=O.data,x=O.loading,y=O.error,C=O.fetchMore;c.useEffect((function(){var e;(null===P||void 0===P?void 0:P.length)&&T(Object(l.a)(null===m||void 0===m||null===(e=m.messagesForNegotiation)||void 0===e?void 0:e.messages).reverse())}),[m]);var w=c.useState(!0),M=Object(s.a)(w,2),N=M[0],R=M[1],L=c.useState(!1),E=Object(s.a)(L,2),_=E[0],F=E[1],B=c.useState([]),I=Object(s.a)(B,2),P=I[0],T=I[1],V=(null===m||void 0===m||null===(e=m.messagesForNegotiation)||void 0===e||null===(t=e.messages)||void 0===t?void 0:t.length)?null===m||void 0===m?void 0:m.messagesForNegotiation.messages[0]:null,U=Object(v.r)({onError:function(e){console.error(e),Object(j.d)({type:"error",message:e.message})},onCompleted:function(e){var t,n,i,a=null===e||void 0===e||null===(t=e.createMessage)||void 0===t?void 0:t.response;if(null===(n=e.createMessage)||void 0===n||null===(i=n.errors)||void 0===i?void 0:i.length){var o,r=null===(o=e.createMessage)||void 0===o?void 0:o.errors.map((function(e){return null===e||void 0===e?void 0:e.text}));Object(j.d)({type:"error",message:"".concat(r.toString())})}else(null===P||void 0===P?void 0:P.length)&&T([].concat(Object(l.a)(P),[a]))}}),W=Object(s.a)(U,1)[0],z=function(){var e=Object(r.a)(o.a.mark((function e(){var t,n,i,a,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!N){e.next=3;break}return R(!1),e.abrupt("return");case 3:if(!(null===P||void 0===P?void 0:P.length)||!C){e.next=19;break}return F(!0),e.prev=5,e.next=8,C({variables:{offset:P.length}});case 8:i=e.sent,a=i.data,r=null===(t=a.messagesForNegotiation)||void 0===t||null===(n=t.messages)||void 0===n?void 0:n.reverse(),T([].concat(Object(l.a)(r),Object(l.a)(P))),F(!1),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(5),F(!1),console.error(e.t0);case 19:case"end":return e.stop()}}),e,null,[[5,15]])})));return function(){return e.apply(this,arguments)}}(),D=function(){var e=Object(r.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,W({variables:{message:t}});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),A={isLoading:_,messages:P,isVisible:(null===m||void 0===m||null===(n=m.messagesForNegotiation)||void 0===n||null===(a=n.messages)||void 0===a?void 0:a.length)!==(null===m||void 0===m||null===(g=m.messagesForNegotiation)||void 0===g?void 0:g.pageCount),handleCreate:D,handleFetchMore:z};return x||void 0===A.isVisible?Object(i.jsx)(S.a,{}):y?Object(i.jsx)("div",{children:"error"}):V?(null===m||void 0===m||null===(f=m.messagesForNegotiation)||void 0===f||null===(h=f.messages)||void 0===h?void 0:h.length)?Object(i.jsxs)(u.a,{component:"main",maxWidth:"sm",children:[Object(i.jsx)(d.a,{}),Object(i.jsx)(k,{propsMessage:A})]}):null:Object(i.jsx)("div",{children:"niente mess ancora"})}}}]);
//# sourceMappingURL=8.81b6daac.chunk.js.map