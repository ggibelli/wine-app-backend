(this["webpackJsonpwine-app-frontend"]=this["webpackJsonpwine-app-frontend"]||[]).push([[16],{454:function(e,t,n){"use strict";n.d(t,"a",(function(){return b}));var i=n(4),o=n(26),r=n(41),s=n(0),a=n(453),c=n.n(a),l=n(151),d=n(385),u=n(468),v=Object(l.a)((function(){return Object(d.a)({root:{display:"flex",flexDirection:"column",alignItems:"center"}})})),b=function(e){var t=v(),n="messaggi"===Object(r.d)().pathname.split("/")[1],a=function(e){var t=e.root,n=void 0===t?null:t,i=e.rootMargin,r=void 0===i?"0px":i,a=e.threshold,c=void 0===a?0:a,l=s.useState(null),d=Object(o.a)(l,2),u=d[0],v=d[1],b=s.useState(null),j=Object(o.a)(b,2),g=j[0],f=j[1],h=s.useRef(null);return s.useEffect((function(){h.current&&h.current.disconnect(),h.current=new window.IntersectionObserver((function(e){var t=Object(o.a)(e,1)[0];return v(t)}),{root:n,rootMargin:r,threshold:c});var e=h.current;return g&&e.observe(g),function(){return e.disconnect()}}),[g,n,r,c]),[f,u]}({threshold:0}),l=Object(o.a)(a,2),d=l[0],b=l[1],j=s.useState(!0),g=Object(o.a)(j,2),f=g[0],h=g[1];return s.useEffect((function(){b&&(null===b||void 0===b?void 0:b.intersectionRatio)>=.5&&f?(e.fetchMore(),e.setIsLoading&&e.setIsLoading(!0),h(!1)):0!==(null===b||void 0===b?void 0:b.intersectionRatio)||f||(h(!0),e.setIsLoading&&e.setIsLoading(!1))}),[null===b||void 0===b?void 0:b.intersectionRatio]),n?Object(i.jsxs)(i.Fragment,{children:[e.isVisible?Object(i.jsxs)("div",{className:t.root,id:"page-bottom-boundary",ref:d,children:[" ",Object(i.jsx)(c.a,{})]}):null,e.children]}):Object(i.jsxs)("div",{className:t.root,children:[e.children,e.isVisible?e.isLoading?Object(i.jsx)(u.a,{}):Object(i.jsxs)("div",{id:"page-bottom-boundary",ref:d,style:{height:30},children:[" ",Object(i.jsx)(c.a,{})]}):null]})}},456:function(e,t,n){"use strict";n.d(t,"a",(function(){return v}));var i=n(4),o=n(81),r=n.n(o),s=n(103),a=n(26),c=n(436),l=(n(0),n(23)),d=n(15),u=n(131),v=function(e){var t=e.id,n=e.isBuy,o=Object(u.c)(),v=Object(d.L)({onCompleted:function(e){var t,n;if(null===(t=e.updateNegotiation)||void 0===t||null===(n=t.errors)||void 0===n?void 0:n.length){var i,o=null===(i=e.updateNegotiation)||void 0===i?void 0:i.errors.map((function(e){return null===e||void 0===e?void 0:e.text}));Object(l.d)({type:"error",message:"".concat(o.toString())})}else Object(l.d)({message:"trattativa chiusa con successo",type:"success"})},onError:function(e){return Object(l.d)({type:"error",message:e.message})}}),b=Object(a.a)(v,2),j=b[0],g=b[1].loading,f=function(){var e=Object(s.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j({variables:{negotiation:{_id:t,isConcluded:!0}}});case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(i.jsx)(c.a,{className:n?o.buyButton:o.sellButton,disabled:g,onClick:f,children:"Dichiara chiusa la trattativa"})}},469:function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var i=n(4),o=n(26),r=n(436),s=n(0),a=n(23),c=n(15),l=n(131),d=n(445),u=n(438),v=n(439),b=n(440),j=n(379),g=n(489),f={.5:"Useless",1:"Useless+",1.5:"Poor",2:"Poor+",2.5:"Ok",3:"Ok+",3.5:"Good",4:"Good+",4.5:"Excellent",5:"Excellent+"},h=function(e){var t=e.idUser,n=e.idNegotiation,h=e.isBuy,O=e.type,m=s.useState(!1),p=Object(o.a)(m,2),x=p[0],y=p[1],w=s.useState(2),C=Object(o.a)(w,2),N=C[0],S=C[1],k=s.useState(-1),R=Object(o.a)(k,2),M=R[0],F=R[1],L=s.useState(""),_=Object(o.a)(L,2),B=_[0],I=_[1],E=Object(l.c)(),P=Object(l.d)(),T=Object(l.b)(),V=Object(c.t)({onCompleted:function(e){var t,n;if(null===(t=e.createReview)||void 0===t||null===(n=t.errors)||void 0===n?void 0:n.length){var i,o=null===(i=e.createReview)||void 0===i?void 0:i.errors.map((function(e){return null===e||void 0===e?void 0:e.text}));Object(a.d)({type:"error",message:"".concat(o.toString())})}else Object(a.d)({type:"success",message:"Recensione creata con successo"});W()},onError:function(e){return Object(a.d)({type:"error",message:e.message})}}),D=Object(o.a)(V,2),U=D[0],A=D[1].loading,W=function(){y(!1)};return Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)(r.a,{className:h?E.buyButton:E.sellButton,disabled:A,onClick:function(){y(!0)},children:"Lascia una recensione"}),Object(i.jsx)("div",{style:{visibility:"hidden"},children:Object(i.jsxs)(u.a,{open:x,onClose:W,"aria-labelledby":"form-dialog-title",children:[Object(i.jsx)(g.a,{id:"form-dialog-title",children:"Lascia una recensione"}),Object(i.jsxs)(v.a,{children:[Object(i.jsxs)("div",{className:T.root,children:[Object(i.jsx)(l.a,{name:"hover-feedback",value:N,precision:.5,onChange:function(e,t){S(t)},onChangeActive:function(e,t){F(t)}}),null!==N&&Object(i.jsx)(d.a,{ml:2,children:f[-1!==M?M:N]})]}),Object(i.jsx)(j.a,{color:"primary",multiline:!0,rows:4,value:B,onChange:function(e){I(e.target.value)},InputLabelProps:{style:{color:"#6d1331"}},InputProps:{className:P.inputSell,classes:{underline:P.underlineSell}},id:"outlined-multiline-flexible",label:"Recensione",placeholder:"Ottima persona con cui...."})]}),Object(i.jsxs)(b.a,{children:[Object(i.jsx)(r.a,{onClick:W,color:"primary",children:"Cancel"}),Object(i.jsx)(r.a,{onClick:function(){U({variables:{review:{forUser:t,rating:N,negotiation:n,content:B,type:O}}})},color:"primary",children:"Recensisci"})]})]})})]})}},515:function(e,t,n){"use strict";n.r(t);var i=n(4),o=n(28),r=n(81),s=n.n(r),a=n(103),c=n(45),l=n(26),d=n(0),u=n(435),v=n(434),b=n(15),j=n(41),g=n(23),f=n(379),h=n(90),O=n(445),m=n(437),p=function(e){var t=e.message;if(!t)return null;var n=Object(g.c)(),o=t.sentBy._id===(null===n||void 0===n?void 0:n._id),r=o?12:0,s=o?0:12;return Object(i.jsx)(O.a,{display:"flex",flexDirection:o?"row-reverse":"row",p:1,m:1,children:Object(i.jsxs)(O.a,{p:1,color:"white",bgcolor:o?"#6d1331":"#707070",style:{borderBottomLeftRadius:12,borderBottomRightRadius:12,borderTopRightRadius:s,borderTopLeftRadius:r},children:[Object(i.jsx)(h.a,{variant:"body1",children:t.content}),Object(i.jsx)(m.a,{container:!0,justify:"flex-end",children:Object(i.jsx)(h.a,{align:"right",variant:"caption",children:t.dateSent})})]})})},x=n(491),y=n.n(x),w=n(381),C=n(378),N=n(454),S=n(456),k=n(469),R=function(e){var t,n=e.propsMessage,o=Object(g.c)(),r=d.useState(""),s=Object(l.a)(r,2),a=s[0],c=s[1],u=d.useState(!1),v=Object(l.a)(u,2),b=v[0],j=v[1],h=d.useState(!0),O=Object(l.a)(h,2),m=O[0],x=O[1],R=d.useRef(null);setTimeout((function(){return x(!1)}),1e3),d.useEffect((function(){if(R.current){if(b)return;R.current.scroll({top:document.body.offsetHeight+1e6,left:0,behavior:"smooth"})}}),[n.messages]);var M=n.messages?n.messages[0]:null;if(!M)return null;var F=M.sentBy._id===(null===o||void 0===o?void 0:o._id)?M.sentTo._id:M.sentBy._id;return n.messages?Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)("div",{style:{height:"75vh",margin:0,padding:0,overflowY:"scroll"},ref:R,children:Object(i.jsx)(N.a,{fetchMore:n.handleFetchMore,isLoading:b,isVisible:n.isVisible&&!m,setIsLoading:j,children:null===(t=n.messages)||void 0===t?void 0:t.map((function(e){return Object(i.jsx)(p,{message:e},null===e||void 0===e?void 0:e._id)}))})}),Object(i.jsx)("hr",{style:{borderWidth:1,borderColor:"#6d1331"}}),Object(i.jsxs)("div",{style:{height:"10vh",backgroundColor:"#fff",paddingTop:0},children:[M.negotiation.isConcluded?Object(i.jsx)(k.a,{isBuy:!0,idNegotiation:M.negotiation._id,idUser:F,type:M.negotiation.type}):Object(i.jsx)(S.a,{id:M.negotiation._id}),Object(i.jsx)(f.a,{fullWidth:!0,multiline:!0,rowsMax:2,variant:"outlined",name:"content",type:"text",placeholder:"",label:"",value:a,onChange:function(e){c(e.target.value)},InputProps:{endAdornment:Object(i.jsx)(w.a,{position:"end",children:Object(i.jsx)(C.a,{disabled:!a,onClick:function(){var e={content:a,sentTo:F,negotiation:M.negotiation._id};n.handleCreate(e),c("")},children:Object(i.jsx)(y.a,{})})})}})]})]}):null},M=n(509);t.default=function(){var e,t,n,r,f,h,O,m,p=Object(j.e)().id,x=Object(g.c)(),y=Object(b.A)({fetchPolicy:"network-only",variables:{id:p,offset:0,limit:20}}),w=y.data,C=y.loading,N=y.error,S=y.fetchMore,k=d.useState([]),F=Object(l.a)(k,2),L=F[0],_=F[1],B=(null===w||void 0===w||null===(e=w.messagesForNegotiation)||void 0===e||null===(t=e.messages)||void 0===t?void 0:t.length)?null===w||void 0===w?void 0:w.messagesForNegotiation.messages[0]:null,I=Object(b.r)({onError:function(e){return Object(g.d)({type:"error",message:e.message})},onCompleted:function(e){var t,n;if(null===(t=e.createMessage)||void 0===t||null===(n=t.errors)||void 0===n?void 0:n.length){var i,o=null===(i=e.createMessage)||void 0===i?void 0:i.errors.map((function(e){return null===e||void 0===e?void 0:e.text}));Object(g.d)({type:"error",message:"".concat(o.toString())})}}}),E=Object(l.a)(I,1)[0];d.useEffect((function(){var e,t;(null===w||void 0===w||null===(e=w.messagesForNegotiation)||void 0===e?void 0:e.messages)&&_(Object(c.a)(null===w||void 0===w||null===(t=w.messagesForNegotiation)||void 0===t?void 0:t.messages).reverse())}),[null===w||void 0===w||null===(n=w.messagesForNegotiation)||void 0===n?void 0:n.messages]);var P=function(){var e=Object(a.a)(s.a.mark((function e(){var t,n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!S){e.next=9;break}return e.prev=1,e.next=4,S({variables:{offset:null===w||void 0===w||null===(t=w.messagesForNegotiation)||void 0===t||null===(n=t.messages)||void 0===n?void 0:n.length}});case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),console.log(e.t0);case 9:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(){return e.apply(this,arguments)}}();if(!B)return Object(i.jsx)("div",{children:"niente mess ancora"});var T=function(){var e=Object(a.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E({variables:{message:t}});case 2:n=Object(o.a)(Object(o.a)({},t),{},{dateSent:Object(M.a)(new Date,"dd MMM yy, H:m"),sentBy:{_id:null===x||void 0===x?void 0:x._id},_id:Date.now().toString()}),(null===L||void 0===L?void 0:L.length)&&_([].concat(Object(c.a)(L),[n]));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),V={isLoading:C,messages:L,isVisible:(null===w||void 0===w||null===(r=w.messagesForNegotiation)||void 0===r||null===(f=r.messages)||void 0===f?void 0:f.length)!==(null===w||void 0===w||null===(h=w.messagesForNegotiation)||void 0===h?void 0:h.pageCount),handleCreate:T,handleFetchMore:P};return!C&&N?Object(i.jsx)("div",{children:"error"}):C||void 0===V.isVisible?Object(i.jsx)("div",{children:"loading"}):(null===w||void 0===w||null===(O=w.messagesForNegotiation)||void 0===O||null===(m=O.messages)||void 0===m?void 0:m.length)?Object(i.jsxs)(v.a,{component:"main",maxWidth:"sm",children:[Object(i.jsx)(u.a,{}),Object(i.jsx)(R,{propsMessage:V})]}):null}}}]);
//# sourceMappingURL=16.1cb8dcfc.chunk.js.map