(this["webpackJsonpwine-app-frontend"]=this["webpackJsonpwine-app-frontend"]||[]).push([[8],{454:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var i=n(4),r=n(439),a=(n(0),n(41)),o=n(455),c=n.n(o),l=function(){return Object(i.jsx)(r.a,{"aria-label":"previous-page",color:"primary",size:"large",startIcon:Object(i.jsx)(c.a,{}),onClick:function(){return Object(a.c)(-1)},children:"Torna indietro"})}},456:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var i=n(4),r=(n(0),n(449)),a=n(14),o=function(e){var t=e.notActive?"#b2b2b2":"white",n=e.notActive?"#8a425a":"primary.main";return Object(i.jsx)(r.a,{boxShadow:3,p:2,m:2,mt:2,px:2,pt:2,width:e.width,color:e.typeAd===a.l.Sell?"primary.main":"white",borderColor:e.typeAd===a.l.Sell?"white":"primary.main",bgcolor:e.typeAd===a.l.Sell?t:n,borderRadius:16,children:e.children})}},458:function(e,t,n){"use strict";n.d(t,"a",(function(){return b}));var i=n(4),r=n(28),a=n(41),o=n(0),c=n(457),l=n.n(c),s=n(131),d=n(233),u=n(384),j=Object(s.a)((function(){return Object(d.a)({root:{display:"flex",flexDirection:"column",alignItems:"center"}})})),b=function(e){var t=j(),n="messaggi"===Object(a.d)().pathname.split("/")[1],c=function(e){var t=e.root,n=void 0===t?null:t,i=e.rootMargin,a=void 0===i?"0px":i,c=e.threshold,l=void 0===c?0:c,s=o.useState(null),d=Object(r.a)(s,2),u=d[0],j=d[1],b=o.useState(null),v=Object(r.a)(b,2),f=v[0],h=v[1],O=o.useRef(null);return o.useEffect((function(){O.current&&O.current.disconnect(),O.current=new window.IntersectionObserver((function(e){var t=Object(r.a)(e,1)[0];return j(t)}),{root:n,rootMargin:a,threshold:l});var e=O.current;return f&&e.observe(f),function(){return e.disconnect()}}),[f,n,a,l]),[h,u]}({threshold:0}),s=Object(r.a)(c,2),d=s[0],b=s[1],v=o.useState(!0),f=Object(r.a)(v,2),h=f[0],O=f[1];return o.useEffect((function(){b&&(null===b||void 0===b?void 0:b.intersectionRatio)>0&&h?(e.fetchMore(),e.setIsLoading&&e.setIsLoading(!0),O(!1)):0!==(null===b||void 0===b?void 0:b.intersectionRatio)||h||(O(!0),e.setIsLoading&&e.setIsLoading(!1))}),[null===b||void 0===b?void 0:b.intersectionRatio]),n?Object(i.jsxs)(i.Fragment,{children:[e.isVisible?e.isLoading?Object(i.jsx)("div",{className:t.root,children:Object(i.jsx)(u.a,{})}):Object(i.jsxs)("div",{className:t.root,id:"page-bottom-boundary",ref:d,children:[" ",Object(i.jsx)(l.a,{})]}):null,e.children]}):Object(i.jsxs)("div",{className:t.root,children:[e.children,e.isVisible?e.isLoading?Object(i.jsx)(u.a,{}):Object(i.jsxs)("div",{id:"page-bottom-boundary",ref:d,style:{height:30},children:[" ",Object(i.jsx)(l.a,{})]}):null]})}},459:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var i=n(4),r=(n(0),n(386)),a=n(231),o=n(235),c=n(14),l=function(e){return Object(i.jsxs)(a.a,{fullWidth:!0,children:[Object(i.jsx)(o.a,{style:{color:"black"},htmlFor:"order",children:"Ordine risultati"}),Object(i.jsxs)(r.a,{native:!0,value:e.order,onChange:function(t){e.setOrder(t.target.value)},inputProps:{name:"order",id:"order"},children:[Object(i.jsx)("option",{value:c.j.CreatedAtDesc,children:"Dal piu recente"}),Object(i.jsx)("option",{value:c.j.CreatedAtAsc,children:"Dal meno recente"}),e.isAds?Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)("option",{value:c.j.PriceDesc,children:"Dal piu caro"}),Object(i.jsx)("option",{value:c.j.PriceAsc,children:"Dal meno caro"})]}):null]})]})}},460:function(e,t,n){"use strict";n.d(t,"a",(function(){return j}));var i=n(4),r=n(56),a=n.n(r),o=n(82),c=n(28),l=n(439),s=(n(0),n(21)),d=n(14),u=n(133),j=function(e){var t=e.id,n=e.isBuy,r=Object(u.c)(),j=Object(d.O)({onCompleted:function(e){var t,n;if(null===(t=e.updateNegotiation)||void 0===t||null===(n=t.errors)||void 0===n?void 0:n.length){var i,r=null===(i=e.updateNegotiation)||void 0===i?void 0:i.errors.map((function(e){return null===e||void 0===e?void 0:e.text}));Object(s.d)({type:"error",message:"".concat(r.toString())})}else Object(s.d)({message:"trattativa chiusa con successo",type:"success"})},onError:function(e){return Object(s.d)({type:"error",message:e.message})}}),b=Object(c.a)(j,2),v=b[0],f=b[1].loading,h=function(){var e=Object(o.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v({variables:{negotiation:{_id:t,isConcluded:!0}}});case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(i.jsx)(l.a,{"aria-label":"close-negotiation",className:n?r.buyButton:r.sellButton,disabled:f,onClick:h,children:"Dichiara chiusa la trattativa"})}},461:function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));var i=n(4),r=n(28),a=n(439),o=n(0),c=n(14),l=n(133),s=n(449),d=n(441),u=n(442),j=n(443),b=n(381),v=n(467),f=n(21),h=function(e){var t=e.review,n=e.disabled,o=e.closeModal,l=Object(c.u)({onCompleted:function(e){var t,n;if(null===(t=e.createReview)||void 0===t||null===(n=t.errors)||void 0===n?void 0:n.length){var i,r=null===(i=e.createReview)||void 0===i?void 0:i.errors.map((function(e){return null===e||void 0===e?void 0:e.text}));Object(f.d)({type:"error",message:"".concat(r.toString())})}else Object(f.d)({type:"success",message:"Recensione creata con successo"})},onError:function(e){return Object(f.d)({type:"error",message:e.message})}}),s=Object(r.a)(l,2),d=s[0],u=s[1].loading;return Object(i.jsx)(a.a,{disabled:n||u,"aria-label":"review",onClick:function(){o&&o(),d({variables:{review:t}})},color:"primary",children:"Recensisci"})},O={.5:"Useless",1:"Useless+",1.5:"Poor",2:"Poor+",2.5:"Ok",3:"Ok+",3.5:"Good",4:"Good+",4.5:"Excellent",5:"Excellent+"},p=function(e){var t=e.idUser,n=e.idNegotiation,f=e.type,p=o.useState(!1),x=Object(r.a)(p,2),g=x[0],m=x[1],y=o.useState(2),C=Object(r.a)(y,2),w=C[0],k=C[1],S=o.useState(-1),A=Object(r.a)(S,2),N=A[0],T=A[1],B=o.useState(""),E=Object(r.a)(B,2),L=E[0],R=E[1],D=Object(l.c)(),I=Object(l.d)(),_=Object(l.b)(),M=function(){m(!1)};return Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)(a.a,{"aria-label":"review",className:f===c.l.Buy?D.buyButton:D.sellButton,onClick:function(){m(!0)},children:"Lascia una recensione"}),Object(i.jsx)("div",{style:{display:"none"},children:Object(i.jsxs)(d.a,{open:g,onClose:M,"aria-labelledby":"form-dialog-title",children:[Object(i.jsx)(v.a,{id:"form-dialog-title",children:"Recensisci la trattativa"}),Object(i.jsxs)(u.a,{children:[Object(i.jsxs)("div",{className:_.root,children:[Object(i.jsx)(l.a,{name:"hover-feedback",value:w,precision:.5,onChange:function(e,t){k(t)},onChangeActive:function(e,t){T(t)}}),null!==w&&Object(i.jsx)(s.a,{ml:2,children:O[-1!==N?N:w]})]}),Object(i.jsx)(b.a,{color:"primary",multiline:!0,rows:4,value:L,error:L.length>0&&L.length<=5,helperText:"Lunghezza minima 5 caratteri",onChange:function(e){R(e.target.value)},InputLabelProps:{style:{color:"#6d1331"}},InputProps:{className:I.inputSell,classes:{underline:I.underlineSell}},id:"outlined-multiline-flexible",label:"Recensione",placeholder:"Ottima persona con cui...."})]}),Object(i.jsxs)(j.a,{children:[Object(i.jsx)(a.a,{"aria-label":"close-modal",onClick:M,color:"primary",children:"Cancel"}),Object(i.jsx)(h,{disabled:L.length<=5,review:{forUser:t,rating:w,negotiation:n,content:L,type:f},closeModal:M})]})]})})]})}},465:function(e,t,n){"use strict";n.d(t,"b",(function(){return O})),n.d(t,"a",(function(){return p}));var i=n(4),r=n(28),a=n(24),o=n(0),c=n(439),l=n(492),s=n(473),d=n.n(s),u=n(430),j=n(490),b=n(541),v=n(8),f=n(530),h=n(21);var O=Object(v.a)({root:{color:f.a[400],"&$checked":{color:f.a[600]}},checked:{}})((function(e){return Object(i.jsx)(b.a,Object(a.a)({color:"default"},e))})),p=function(e){var t=Object(h.e)(),n=o.useState(!1),a=Object(r.a)(n,2),s=a[0],b=a[1],v=o.useState(!1),f=Object(r.a)(v,2),p=f[0],x=f[1],g=o.useState({priceTo:function(e){return e<=(null===t||void 0===t?void 0:t.priceTo)},abv:function(e){return e>=(null===t||void 0===t?void 0:t.abv)-.5||e<=(null===t||void 0===t?void 0:t.abv)+.5},harvest:function(e){return e===(null===t||void 0===t?void 0:t.harvest)||e-1===(null===t||void 0===t?void 0:t.harvest)},litersTo:function(e){return e>=(null===t||void 0===t?void 0:t.litersTo)}}),m=Object(r.a)(g,2),y=m[0],C=m[1];o.useEffect((function(){if(e.list.length>0){var t=function(e,t){var n=Object.keys(t);return e.filter((function(e){return n.every((function(n){return"function"!==typeof t[n]||t[n](e[n])}))}))}(e.list,y);e.setFilteredList(t)}}),[y,e.list]);return Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)(c.a,{onClick:function(){return x(!p)},"aria-label":"filter",color:"primary",size:"large",startIcon:Object(i.jsx)(d.a,{}),children:"Filtri"}),Object(i.jsxs)(l.a,{in:p,children:[e.children,Object(i.jsx)(u.a,{}),Object(i.jsx)(j.a,{control:Object(i.jsx)(O,{checked:s,onChange:function(){C(s?{priceTo:function(e){return e<=(null===t||void 0===t?void 0:t.priceTo)},abv:function(e){return e>=(null===t||void 0===t?void 0:t.abv)-.5||e<=(null===t||void 0===t?void 0:t.abv)+.5},harvest:function(e){return e===(null===t||void 0===t?void 0:t.harvest)||e-1===(null===t||void 0===t?void 0:t.harvest)},litersTo:function(e){return e>=(null===t||void 0===t?void 0:t.litersTo)}}:{priceTo:function(){return!0},harvest:function(){return!0},abv:function(){return!0},litersTo:function(){return!0}}),b(!s)},name:"showAll"}),label:"Mostra tutti gli annunci per questo vino"})]})]})}},467:function(e,t,n){"use strict";var i=n(1),r=n(5),a=n(0),o=(n(10),n(7)),c=n(8),l=n(91),s=a.forwardRef((function(e,t){var n=e.children,c=e.classes,s=e.className,d=e.disableTypography,u=void 0!==d&&d,j=Object(r.a)(e,["children","classes","className","disableTypography"]);return a.createElement("div",Object(i.a)({className:Object(o.a)(c.root,s),ref:t},j),u?n:a.createElement(l.a,{component:"h2",variant:"h6"},n))}));t.a=Object(c.a)({root:{margin:0,padding:"16px 24px",flex:"0 0 auto"}},{name:"MuiDialogTitle"})(s)},545:function(e,t,n){"use strict";n.r(t);var i=n(4),r=n(56),a=n.n(r),o=n(45),c=n(82),l=n(28),s=n(0),d=n(91),u=n(438),j=n(437),b=n(14),v=n(429),f=n(41),h=n(439),O=n(35),p=n(482),x=n(456),g=n(460),m=n(133),y=n(440),C=n(461),w=n(21),k=function(e){var t,n=e.negotiation,r=Object(w.c)(),a=Object(m.c)(),o=Object(O.a)(),c=Object(p.a)(o.breakpoints.up("sm"))?400:250,u=s.useState(!0),j=Object(l.a)(u,2),k=j[0],S=j[1],A=n.type===b.l.Buy,N=-1!==(null===(t=n.review)||void 0===t?void 0:t.findIndex((function(e){return(null===e||void 0===e?void 0:e.createdBy._id)===(null===r||void 0===r?void 0:r._id)})));return Object(i.jsxs)(x.a,{width:c,typeAd:n.type,children:[Object(i.jsxs)(v.a,{"aria-label":"link-negotiation",component:f.a,to:"/trattative/".concat(n._id),style:{textDecoration:"none"},children:[Object(i.jsxs)(d.a,{component:"h5",variant:"h6",color:A?"textSecondary":"primary",children:[A?"Compro":"Vendo"," ","AdWine"===n.ad.__typename&&n.ad.wineName," "]}),Object(i.jsxs)(d.a,{align:"left",variant:"body1",color:A?"textSecondary":"primary",children:["Aperta da: cantina ",n.createdBy.firstName,Object(i.jsx)("br",{}),"Per cantina: ",n.forUserAd.firstName,Object(i.jsx)("br",{}),n.isConcluded?"Trattativa conclusa":null]}),Object(i.jsx)("br",{}),Object(i.jsxs)(d.a,{align:"right",variant:"caption",color:A?"textSecondary":"primary",children:["Trattativa aperta: ",n.dateCreated]}),n.isConcluded?Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)("br",{}),Object(i.jsxs)(d.a,{align:"right",variant:"caption",color:A?"textSecondary":"primary",children:["Trattativa conclusa: ",n.dateConcluded]})]}):null]}),Object(i.jsx)(y.a,{children:n.isConcluded||!k?N?null:Object(i.jsx)(C.a,{idNegotiation:n._id,type:n.type,idUser:n.forUserAd._id}):Object(i.jsxs)("div",{onClick:function(){S(!1)},children:[" ",Object(i.jsx)(g.a,{isBuy:A,id:n._id})]})}),Object(i.jsx)(h.a,{className:A?a.buyButton:a.sellButton,color:"primary",component:f.a,to:"/messaggi/".concat(n._id),children:"Apri la chat"})]})},S=n(454),A=n(459),N=n(458),T=n(465),B=n(490),E=n(430),L=n(155);t.default=function(){var e,t,n,r=s.useState(b.j.CreatedAtDesc),v=Object(l.a)(r,2),f=v[0],h=v[1],O=Object(b.J)({variables:{offset:0,limit:4,orderBy:f,isConcluded:!1},onCompleted:function(e){var t=e.negotiations;return D(null===t||void 0===t?void 0:t.negotiations)},onError:function(e){return console.log(e)}}),p=O.data,x=O.loading,g=O.error,m=O.fetchMore,y=s.useState([]),C=Object(l.a)(y,2),R=C[0],D=C[1],I=s.useState(!1),_=Object(l.a)(I,2),M=_[0],F=_[1],P=s.useState(!1),U=Object(l.a)(P,2),z=U[0],V=U[1],G=s.useState(!1),J=Object(l.a)(G,2),W=J[0],q=J[1],$=function(){var e=Object(c.a)(a.a.mark((function e(){var t,n,i,r,c,l;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(q(!0),!M||!m){e.next=9;break}return F(!1),e.next=5,m({variables:{offset:0,limit:4,orderBy:f,isConcluded:!1}});case 5:n=e.sent,i=n.data,D(null===(t=i.negotiations)||void 0===t?void 0:t.negotiations),q(!1);case 9:if(!m||M){e.next=23;break}return e.prev=10,F(!0),e.next=14,m({variables:{limit:null===R||void 0===R?void 0:R.length,isConcluded:!0}});case 14:c=e.sent,l=c.data,D([].concat(Object(o.a)(R),Object(o.a)(null===(r=l.negotiations)||void 0===r?void 0:r.negotiations))),q(!1),e.next=23;break;case 20:e.prev=20,e.t0=e.catch(10),Object(w.d)({type:"error",message:"Errore durante il caricamento delle trattative"});case 23:case"end":return e.stop()}}),e,null,[[10,20]])})));return function(){return e.apply(this,arguments)}}(),H=(null===R||void 0===R?void 0:R.length)<(null===p||void 0===p||null===(e=p.negotiations)||void 0===e?void 0:e.pageCount);if(s.useEffect((function(){(null===R||void 0===R?void 0:R.length)&&m&&(q(!0),m({variables:{orderBy:f,limit:null===R||void 0===R?void 0:R.length,isConcluded:M}}).then((function(e){var t,n=e.data;q(!1),D(null===(t=n.negotiations)||void 0===t?void 0:t.negotiations)})).catch((function(e){q(!1),console.log(e)})))}),[f]),x)return Object(i.jsx)(L.a,{});if(g)return Object(i.jsx)("div",{children:g.message});if(0===(null===R||void 0===R?void 0:R.length))return Object(i.jsx)("div",{children:"Non hai ancora aperto trattative"});if((null===R||void 0===R?void 0:R.length)&&0!==(null===p||void 0===p||null===(t=p.negotiations)||void 0===t||null===(n=t.negotiations)||void 0===n?void 0:n.length)){var K=function(){var e=Object(c.a)(a.a.mark((function e(){var t,n,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(V(!0),!m){e.next=15;break}return e.prev=2,e.next=5,m({variables:{offset:R.length,orderBy:f,isConcluded:M}});case 5:n=e.sent,i=n.data,D([].concat(Object(o.a)(R),Object(o.a)(null===(t=i.negotiations)||void 0===t?void 0:t.negotiations))),V(!1),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(2),console.log(e.t0),V(!1);case 15:case"end":return e.stop()}}),e,null,[[2,11]])})));return function(){return e.apply(this,arguments)}}();return Object(i.jsxs)(j.a,{component:"main",maxWidth:"xs",children:[Object(i.jsx)(u.a,{}),Object(i.jsx)(S.a,{}),Object(i.jsx)("br",{}),Object(i.jsx)(d.a,{color:"primary",component:"h3",variant:"h5",children:"Le tue trattative attive"}),Object(i.jsx)("br",{}),Object(i.jsx)(A.a,{setOrder:h,order:f}),Object(i.jsx)(E.a,{}),Object(i.jsx)(B.a,{control:Object(i.jsx)(T.b,{checked:M,onChange:$,name:"showAll"}),label:"Mostra anche le trattative chiuse"}),W?Object(i.jsx)(L.a,{}):Object(i.jsx)(N.a,{fetchMore:K,isVisible:H,isLoading:z,children:R.map((function(e){return Object(i.jsx)(k,{negotiation:e},null===e||void 0===e?void 0:e._id)}))})]})}return Object(i.jsx)("div",{children:"Grave errore"})}}}]);
//# sourceMappingURL=8.d88fabe6.chunk.js.map