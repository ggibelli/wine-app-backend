(this["webpackJsonpwine-app-frontend"]=this["webpackJsonpwine-app-frontend"]||[]).push([[13],{483:function(e,t,n){"use strict";var i=n(52),a=n(53);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=a(n(0)),r=(0,i(n(54)).default)(o.createElement("path",{d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore");t.default=r},484:function(e,t,n){"use strict";n.d(t,"a",(function(){return b}));var i=n(31),a=n(42),o=n(0),r=n(483),s=n.n(r),l=n(138),c=n(243),d=n(399),u=n(3),v=Object(l.a)((function(){return Object(c.a)({root:{display:"flex",flexDirection:"column",alignItems:"center"}})})),b=function(e){var t=v(),n="messaggi"===Object(a.d)().pathname.split("/")[1],r=function(e){var t=e.root,n=void 0===t?null:t,a=e.rootMargin,r=void 0===a?"0px":a,s=e.threshold,l=void 0===s?0:s,c=o.useState(null),d=Object(i.a)(c,2),u=d[0],v=d[1],b=o.useState(null),j=Object(i.a)(b,2),g=j[0],f=j[1],h=o.useRef(null);return o.useEffect((function(){h.current&&h.current.disconnect(),h.current=new window.IntersectionObserver((function(e){var t=Object(i.a)(e,1)[0];return v(t)}),{root:n,rootMargin:r,threshold:l});var e=h.current;return g&&e.observe(g),function(){return e.disconnect()}}),[g,n,r,l]),[f,u]}({threshold:0}),l=Object(i.a)(r,2),c=l[0],b=l[1],j=o.useState(!0),g=Object(i.a)(j,2),f=g[0],h=g[1];return o.useEffect((function(){b&&(null===b||void 0===b?void 0:b.intersectionRatio)>0&&f?(e.fetchMore(),e.setIsLoading&&e.setIsLoading(!0),h(!1)):0!==(null===b||void 0===b?void 0:b.intersectionRatio)||f||(h(!0),e.setIsLoading&&e.setIsLoading(!1))}),[null===b||void 0===b?void 0:b.intersectionRatio]),n?Object(u.jsxs)(u.Fragment,{children:[e.isVisible?e.isLoading?Object(u.jsx)("div",{className:t.root,children:Object(u.jsx)(d.a,{})}):Object(u.jsxs)("div",{className:t.root,id:"page-bottom-boundary",ref:c,children:[" ",Object(u.jsx)(s.a,{})]}):null,e.children]}):Object(u.jsxs)("div",{className:t.root,children:[e.children,e.isVisible?e.isLoading?Object(u.jsx)(d.a,{}):Object(u.jsxs)("div",{id:"page-bottom-boundary",ref:c,style:{height:30},children:[" ",Object(u.jsx)(s.a,{})]}):null]})}},486:function(e,t,n){"use strict";n.d(t,"a",(function(){return O}));var i=n(31),a=n(0),o=n(458),r=n(468),s=n(472),l=n(469),c=n(55),d=n.n(c),u=n(81),v=n(18),b=n(13),j=n(3),g=function(e){var t=e.id,n=e.handleClose,a=Object(b.M)({onCompleted:function(e){var t,n;if(null===(t=e.updateNegotiation)||void 0===t||null===(n=t.errors)||void 0===n?void 0:n.length){var i,a=null===(i=e.updateNegotiation)||void 0===i?void 0:i.errors.map((function(e){return null===e||void 0===e?void 0:e.text}));Object(v.d)({type:"error",message:"".concat(a.toString())})}else Object(v.d)({message:"trattativa chiusa con successo",type:"success"})},onError:function(e){return Object(v.d)({type:"error",message:e.message})}}),r=Object(i.a)(a,2),s=r[0],l=r[1].loading,c=function(){var e=Object(u.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n(),e.next=3,s({variables:{negotiation:{_id:t,isConcluded:!0}}});case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(j.jsx)(o.a,{"aria-label":"close-negotiation",disabled:l,onClick:c,children:"Dichiara chiusa la trattativa"})},f=n(97),h=function(e){var t=e.id,n=e.handleClose,a=Object(b.t)({onCompleted:function(e){var t,n;if(null===(t=e.deleteNegotiation)||void 0===t||null===(n=t.errors)||void 0===n?void 0:n.length){var i,a=null===(i=e.deleteNegotiation)||void 0===i?void 0:i.errors.map((function(e){return null===e||void 0===e?void 0:e.text}));Object(v.d)({type:"error",message:"".concat(a.toString())})}else Object(v.d)({message:"trattativa cancellata con successo",type:"info"})},onError:function(e){return Object(v.d)({type:"error",message:e.message})},update:function(e,t){var n,i=t.data;Object(f.g)(e,null===i||void 0===i||null===(n=i.deleteNegotiation)||void 0===n?void 0:n.response)}}),r=Object(i.a)(a,2),s=r[0],l=r[1].loading,c=function(){var e=Object(u.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n(),e.next=3,s({variables:{id:t}});case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(j.jsx)(o.a,{"aria-label":"cancel-negotiation",disabled:l,onClick:c,children:"Cancella la trattativa"})},p=n(140),O=function(e){var t=e.id,n=e.isBuy,c=e.isMessage,d=Object(p.c)(),u=a.useState(!1),v=Object(i.a)(u,2),b=v[0],f=v[1],O=function(){f(!1)};return n=!!c,Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)(o.a,{fullWidth:!0,"aria-label":"close-negotiation-popup",className:n?d.buyButton:d.sellButton,onClick:function(){f(!0)},children:"Chiudi trattativa"}),Object(j.jsx)("div",{style:{display:"none"},children:Object(j.jsxs)(r.a,{open:b,onClose:O,"aria-labelledby":"close-negotiation",children:[Object(j.jsxs)(l.a,{children:[Object(j.jsx)(h,{id:t,handleClose:O}),Object(j.jsx)(g,{id:t,handleClose:O})]}),Object(j.jsx)(s.a,{children:Object(j.jsx)(o.a,{onClick:O,color:"primary",children:"Cancel"})})]})})]})}},487:function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));var i=n(31),a=n(458),o=n(0),r=n(13),s=n(140),l=n(473),c=n(468),d=n(469),u=n(472),v=n(401),b=n(494),j=n(18),g=n(3),f=function(e){var t=e.review,n=e.disabled,o=e.closeModal,s=Object(r.r)({onCompleted:function(e){var t,n;if(null===(t=e.createReview)||void 0===t||null===(n=t.errors)||void 0===n?void 0:n.length){var i,a=null===(i=e.createReview)||void 0===i?void 0:i.errors.map((function(e){return null===e||void 0===e?void 0:e.text}));Object(j.d)({type:"error",message:"".concat(a.toString())})}else Object(j.d)({type:"success",message:"Recensione creata con successo"})},onError:function(e){return Object(j.d)({type:"error",message:e.message})}}),l=Object(i.a)(s,2),c=l[0],d=l[1].loading;return Object(g.jsx)(a.a,{disabled:n||d,"aria-label":"review",onClick:function(){o&&o(),c({variables:{review:t}})},color:"primary",children:"Recensisci"})},h={.5:"Useless",1:"Useless+",1.5:"Poor",2:"Poor+",2.5:"Ok",3:"Ok+",3.5:"Good",4:"Good+",4.5:"Excellent",5:"Excellent+"},p=function(e){var t=e.idUser,n=e.idNegotiation,j=e.type,p=e.isMessage,O=o.useState(!1),m=Object(i.a)(O,2),x=m[0],y=m[1],C=o.useState(2),w=Object(i.a)(C,2),M=w[0],N=w[1],k=o.useState(-1),S=Object(i.a)(k,2),R=S[0],L=S[1],E=o.useState(""),_=Object(i.a)(E,2),F=_[0],B=_[1],I=Object(s.c)(),P=Object(s.d)(),T=Object(s.b)(),V=function(){y(!1)};return j=p?r.i.Sell:j,Object(g.jsxs)(g.Fragment,{children:[Object(g.jsx)(a.a,{fullWidth:!0,"aria-label":"review",className:j===r.i.Buy?I.buyButton:I.sellButton,onClick:function(){y(!0)},children:"Lascia una recensione"}),Object(g.jsx)("div",{style:{display:"none"},children:Object(g.jsxs)(c.a,{open:x,onClose:V,"aria-labelledby":"form-dialog-title",children:[Object(g.jsx)(b.a,{id:"form-dialog-title",children:"Recensisci la trattativa"}),Object(g.jsxs)(d.a,{children:[Object(g.jsxs)("div",{className:T.root,children:[Object(g.jsx)(s.a,{name:"hover-feedback",value:M,precision:.5,onChange:function(e,t){N(t)},onChangeActive:function(e,t){L(t)}}),null!==M&&Object(g.jsx)(l.a,{ml:2,children:h[-1!==R?R:M]})]}),Object(g.jsx)(v.a,{color:"primary",multiline:!0,rows:4,value:F,error:F.length>0&&F.length<=5,helperText:"Lunghezza minima 5 caratteri",onChange:function(e){B(e.target.value)},InputLabelProps:{style:{color:"#6d1331"}},InputProps:{className:P.inputSell,classes:{underline:P.underlineSell}},id:"outlined-multiline-flexible",label:"Recensione",placeholder:"Ottima persona con cui...."})]}),Object(g.jsxs)(u.a,{children:[Object(g.jsx)(a.a,{"aria-label":"close-modal",onClick:V,color:"primary",children:"Cancel"}),Object(g.jsx)(f,{disabled:F.length<=5,review:{forUser:t,rating:M,negotiation:n,content:F,type:j},closeModal:V})]})]})})]})}},494:function(e,t,n){"use strict";var i=n(1),a=n(4),o=n(0),r=(n(8),n(5)),s=n(6),l=n(94),c=o.forwardRef((function(e,t){var n=e.children,s=e.classes,c=e.className,d=e.disableTypography,u=void 0!==d&&d,v=Object(a.a)(e,["children","classes","className","disableTypography"]);return o.createElement("div",Object(i.a)({className:Object(r.a)(s.root,c),ref:t},v),u?n:o.createElement(l.a,{component:"h2",variant:"h6"},n))}));t.a=Object(s.a)({root:{margin:0,padding:"16px 24px",flex:"0 0 auto"}},{name:"MuiDialogTitle"})(c)},538:function(e,t,n){"use strict";var i=n(52),a=n(53);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=a(n(0)),r=(0,i(n(54)).default)(o.createElement("path",{d:"M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"}),"Send");t.default=r},564:function(e,t,n){"use strict";n.r(t);var i=n(55),a=n.n(i),o=n(81),r=n(31),s=n(44),l=n(0),c=n(455),d=n(470),u=n(13),v=n(42),b=n(18),j=n(401),g=n(94),f=n(473),h=n(471),p=n(3),O=function(e){var t=e.message;if(!t)return null;var n=Object(b.c)(),i=t.sentBy._id===(null===n||void 0===n?void 0:n._id),a=i?12:0,o=i?0:12;return Object(p.jsx)(f.a,{"data-testid":"message-box",display:"flex",flexDirection:i?"row-reverse":"row",p:1,m:1,children:Object(p.jsxs)(f.a,{p:1,color:"white",bgcolor:i?"#6d1331":"#707070",style:{borderBottomLeftRadius:12,borderBottomRightRadius:12,borderTopRightRadius:o,borderTopLeftRadius:a},children:[Object(p.jsx)(g.a,{variant:"body1",children:t.content}),Object(p.jsx)(h.a,{container:!0,justify:"flex-end",children:Object(p.jsx)(g.a,{align:"right",variant:"caption",children:t.dateSent})})]})})},m=n(538),x=n.n(m),y=n(403),C=n(400),w=n(484),M=n(487),N=n(486),k=function(e){var t,n=e.propsMessage,i=Object(b.c)(),a=l.useState(""),o=Object(r.a)(a,2),s=o[0],c=o[1],d=l.useState(!1),u=Object(r.a)(d,2),v=u[0],g=u[1],f=l.useRef(null);l.useEffect((function(){if(f.current){if(v)return;f.current.scroll({top:document.body.offsetHeight+1e6,left:0,behavior:"smooth"})}return function(){}}),[n.messages]);var h=n.messages?n.messages[0]:null;if(!h)return null;var m=h.sentBy._id===(null===i||void 0===i?void 0:i._id)?h.sentTo._id:h.sentBy._id;return n.messages?Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)("div",{style:{height:"75vh",margin:0,padding:0,overflowY:"scroll"},ref:f,children:Object(p.jsx)(w.a,{fetchMore:n.handleFetchMore,isLoading:n.isLoading,isVisible:n.isVisible,setIsLoading:g,children:null===(t=n.messages)||void 0===t?void 0:t.map((function(e){return Object(p.jsx)(O,{message:e},null===e||void 0===e?void 0:e._id)}))})}),Object(p.jsx)("hr",{style:{borderWidth:1,borderColor:"#6d1331"}}),Object(p.jsxs)("div",{style:{height:"10vh",backgroundColor:"#fff",paddingTop:0},children:[h.negotiation.isConcluded?Object(p.jsx)(M.a,{idNegotiation:h.negotiation._id,idUser:m,isMessage:!0,type:h.negotiation.type}):Object(p.jsx)(N.a,{id:h.negotiation._id,isMessage:!0}),Object(p.jsx)(j.a,{fullWidth:!0,multiline:!0,rowsMax:2,variant:"outlined",name:"content",type:"text",placeholder:"",label:"",value:s,onChange:function(e){c(e.target.value)},inputProps:{"aria-label":"input-message"},InputProps:{endAdornment:Object(p.jsx)(y.a,{position:"end",children:Object(p.jsx)(C.a,{"aria-label":"send",disabled:!s,onClick:function(){var e={content:s,sentTo:m,negotiation:h.negotiation._id};n.handleCreate(e),c("")},children:Object(p.jsx)(x.a,{})})})}})]})]}):null},S=n(164);t.default=function(){var e,t,n,i,j,g,f,h=Object(v.e)().id,O=Object(u.A)({fetchPolicy:"network-only",variables:{id:h,offset:0,limit:20},onCompleted:function(e){var t=e.messagesForNegotiation;T(Object(s.a)(null===t||void 0===t?void 0:t.messages).reverse())}}),m=O.data,x=O.loading,y=O.error,C=O.fetchMore;l.useEffect((function(){var e;(null===P||void 0===P?void 0:P.length)&&T(Object(s.a)(null===m||void 0===m||null===(e=m.messagesForNegotiation)||void 0===e?void 0:e.messages).reverse())}),[m]);var w=l.useState(!0),M=Object(r.a)(w,2),N=M[0],R=M[1],L=l.useState(!1),E=Object(r.a)(L,2),_=E[0],F=E[1],B=l.useState([]),I=Object(r.a)(B,2),P=I[0],T=I[1],V=(null===m||void 0===m||null===(e=m.messagesForNegotiation)||void 0===e||null===(t=e.messages)||void 0===t?void 0:t.length)?null===m||void 0===m?void 0:m.messagesForNegotiation.messages[0]:null,U=Object(u.p)({onError:function(e){console.error(e),Object(b.d)({type:"error",message:e.message})},onCompleted:function(e){var t,n,i,a=null===e||void 0===e||null===(t=e.createMessage)||void 0===t?void 0:t.response;if(null===(n=e.createMessage)||void 0===n||null===(i=n.errors)||void 0===i?void 0:i.length){var o,r=null===(o=e.createMessage)||void 0===o?void 0:o.errors.map((function(e){return null===e||void 0===e?void 0:e.text}));Object(b.d)({type:"error",message:"".concat(r.toString())})}else(null===P||void 0===P?void 0:P.length)&&T([].concat(Object(s.a)(P),[a]))}}),W=Object(r.a)(U,1)[0],z=function(){var e=Object(o.a)(a.a.mark((function e(){var t,n,i,o,r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!N){e.next=3;break}return R(!1),e.abrupt("return");case 3:if(!(null===P||void 0===P?void 0:P.length)||!C){e.next=19;break}return F(!0),e.prev=5,e.next=8,C({variables:{offset:P.length}});case 8:i=e.sent,o=i.data,r=null===(t=o.messagesForNegotiation)||void 0===t||null===(n=t.messages)||void 0===n?void 0:n.reverse(),T([].concat(Object(s.a)(r),Object(s.a)(P))),F(!1),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(5),F(!1),console.error(e.t0);case 19:case"end":return e.stop()}}),e,null,[[5,15]])})));return function(){return e.apply(this,arguments)}}(),D=function(){var e=Object(o.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,W({variables:{message:t}});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),A={isLoading:_,messages:P,isVisible:(null===m||void 0===m||null===(n=m.messagesForNegotiation)||void 0===n||null===(i=n.messages)||void 0===i?void 0:i.length)!==(null===m||void 0===m||null===(j=m.messagesForNegotiation)||void 0===j?void 0:j.pageCount),handleCreate:D,handleFetchMore:z};return x||void 0===A.isVisible?Object(p.jsx)(S.a,{}):y?Object(p.jsx)("div",{children:"error"}):V?(null===m||void 0===m||null===(g=m.messagesForNegotiation)||void 0===g||null===(f=g.messages)||void 0===f?void 0:f.length)?Object(p.jsxs)(d.a,{component:"main",maxWidth:"sm",children:[Object(p.jsx)(c.a,{}),Object(p.jsx)(k,{propsMessage:A})]}):null:Object(p.jsx)("div",{children:"niente mess ancora"})}}}]);