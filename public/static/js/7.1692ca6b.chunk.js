(this["webpackJsonpwine-app-frontend"]=this["webpackJsonpwine-app-frontend"]||[]).push([[7],{480:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var i=n(458),r=(n(0),n(42)),a=n(481),o=n.n(a),c=n(3),l=function(){return Object(c.jsx)(i.a,{"aria-label":"previous-page",color:"primary",size:"large",startIcon:Object(c.jsx)(o.a,{}),onClick:function(){return Object(r.c)(-1)},children:"Torna indietro"})}},482:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));n(0);var i=n(473),r=n(13),a=n(3),o=function(e){var t=e.notActive?"#b2b2b2":"white",n=e.notActive?"#8a425a":"primary.main";return Object(a.jsx)(i.a,{boxShadow:3,p:2,m:2,mt:2,px:2,pt:2,width:e.width,color:e.typeAd===r.i.Sell?"primary.main":"white",borderColor:e.typeAd===r.i.Sell?"white":"primary.main",bgcolor:e.typeAd===r.i.Sell?t:n,borderRadius:16,children:e.children})}},484:function(e,t,n){"use strict";n.d(t,"a",(function(){return j}));var i=n(31),r=n(42),a=n(0),o=n(483),c=n.n(o),l=n(138),s=n(243),d=n(399),u=n(3),v=Object(l.a)((function(){return Object(s.a)({root:{display:"flex",flexDirection:"column",alignItems:"center"}})})),j=function(e){var t=v(),n="messaggi"===Object(r.d)().pathname.split("/")[1],o=function(e){var t=e.root,n=void 0===t?null:t,r=e.rootMargin,o=void 0===r?"0px":r,c=e.threshold,l=void 0===c?0:c,s=a.useState(null),d=Object(i.a)(s,2),u=d[0],v=d[1],j=a.useState(null),b=Object(i.a)(j,2),h=b[0],f=b[1],O=a.useRef(null);return a.useEffect((function(){O.current&&O.current.disconnect(),O.current=new window.IntersectionObserver((function(e){var t=Object(i.a)(e,1)[0];return v(t)}),{root:n,rootMargin:o,threshold:l});var e=O.current;return h&&e.observe(h),function(){return e.disconnect()}}),[h,n,o,l]),[f,u]}({threshold:0}),l=Object(i.a)(o,2),s=l[0],j=l[1],b=a.useState(!0),h=Object(i.a)(b,2),f=h[0],O=h[1];return a.useEffect((function(){j&&(null===j||void 0===j?void 0:j.intersectionRatio)>0&&f?(e.fetchMore(),e.setIsLoading&&e.setIsLoading(!0),O(!1)):0!==(null===j||void 0===j?void 0:j.intersectionRatio)||f||(O(!0),e.setIsLoading&&e.setIsLoading(!1))}),[null===j||void 0===j?void 0:j.intersectionRatio]),n?Object(u.jsxs)(u.Fragment,{children:[e.isVisible?e.isLoading?Object(u.jsx)("div",{className:t.root,children:Object(u.jsx)(d.a,{})}):Object(u.jsxs)("div",{className:t.root,id:"page-bottom-boundary",ref:s,children:[" ",Object(u.jsx)(c.a,{})]}):null,e.children]}):Object(u.jsxs)("div",{className:t.root,children:[e.children,e.isVisible?e.isLoading?Object(u.jsx)(d.a,{}):Object(u.jsxs)("div",{id:"page-bottom-boundary",ref:s,style:{height:30},children:[" ",Object(u.jsx)(c.a,{})]}):null]})}},485:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));n(0);var i=n(405),r=n(241),a=n(245),o=n(13),c=n(3),l=function(e){return Object(c.jsxs)(r.a,{fullWidth:!0,children:[Object(c.jsx)(a.a,{style:{color:"black"},htmlFor:"order",children:"Ordine risultati"}),Object(c.jsxs)(i.a,{native:!0,value:e.order,onChange:function(t){e.setOrder(t.target.value)},inputProps:{name:"order",id:"order"},children:[Object(c.jsx)("option",{value:o.h.CreatedAtDesc,children:"Dal piu recente"}),Object(c.jsx)("option",{value:o.h.CreatedAtAsc,children:"Dal meno recente"}),e.isAds?Object(c.jsxs)(c.Fragment,{children:[Object(c.jsx)("option",{value:o.h.PriceDesc,children:"Dal piu caro"}),Object(c.jsx)("option",{value:o.h.PriceAsc,children:"Dal meno caro"})]}):null]})]})}},486:function(e,t,n){"use strict";n.d(t,"a",(function(){return g}));var i=n(31),r=n(0),a=n(458),o=n(468),c=n(472),l=n(469),s=n(55),d=n.n(s),u=n(81),v=n(18),j=n(13),b=n(3),h=function(e){var t=e.id,n=e.handleClose,r=Object(j.M)({onCompleted:function(e){var t,n;if(null===(t=e.updateNegotiation)||void 0===t||null===(n=t.errors)||void 0===n?void 0:n.length){var i,r=null===(i=e.updateNegotiation)||void 0===i?void 0:i.errors.map((function(e){return null===e||void 0===e?void 0:e.text}));Object(v.d)({type:"error",message:"".concat(r.toString())})}else Object(v.d)({message:"trattativa chiusa con successo",type:"success"})},onError:function(e){return Object(v.d)({type:"error",message:e.message})}}),o=Object(i.a)(r,2),c=o[0],l=o[1].loading,s=function(){var e=Object(u.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n(),e.next=3,c({variables:{negotiation:{_id:t,isConcluded:!0}}});case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(b.jsx)(a.a,{"aria-label":"close-negotiation",disabled:l,onClick:s,children:"Dichiara chiusa la trattativa"})},f=n(97),O=function(e){var t=e.id,n=e.handleClose,r=Object(j.t)({onCompleted:function(e){var t,n;if(null===(t=e.deleteNegotiation)||void 0===t||null===(n=t.errors)||void 0===n?void 0:n.length){var i,r=null===(i=e.deleteNegotiation)||void 0===i?void 0:i.errors.map((function(e){return null===e||void 0===e?void 0:e.text}));Object(v.d)({type:"error",message:"".concat(r.toString())})}else Object(v.d)({message:"trattativa cancellata con successo",type:"info"})},onError:function(e){return Object(v.d)({type:"error",message:e.message})},update:function(e,t){var n,i=t.data;Object(f.g)(e,null===i||void 0===i||null===(n=i.deleteNegotiation)||void 0===n?void 0:n.response)}}),o=Object(i.a)(r,2),c=o[0],l=o[1].loading,s=function(){var e=Object(u.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n(),e.next=3,c({variables:{id:t}});case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(b.jsx)(a.a,{"aria-label":"cancel-negotiation",disabled:l,onClick:s,children:"Cancella la trattativa"})},p=n(140),g=function(e){var t=e.id,n=e.isBuy,s=e.isMessage,d=Object(p.c)(),u=r.useState(!1),v=Object(i.a)(u,2),j=v[0],f=v[1],g=function(){f(!1)};return n=!!s,Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)(a.a,{fullWidth:!0,"aria-label":"close-negotiation-popup",className:n?d.buyButton:d.sellButton,onClick:function(){f(!0)},children:"Chiudi trattativa"}),Object(b.jsx)("div",{style:{display:"none"},children:Object(b.jsxs)(o.a,{open:j,onClose:g,"aria-labelledby":"close-negotiation",children:[Object(b.jsxs)(l.a,{children:[Object(b.jsx)(O,{id:t,handleClose:g}),Object(b.jsx)(h,{id:t,handleClose:g})]}),Object(b.jsx)(c.a,{children:Object(b.jsx)(a.a,{onClick:g,color:"primary",children:"Cancel"})})]})})]})}},487:function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));var i=n(31),r=n(458),a=n(0),o=n(13),c=n(140),l=n(473),s=n(468),d=n(469),u=n(472),v=n(401),j=n(494),b=n(18),h=n(3),f=function(e){var t=e.review,n=e.disabled,a=e.closeModal,c=Object(o.r)({onCompleted:function(e){var t,n;if(null===(t=e.createReview)||void 0===t||null===(n=t.errors)||void 0===n?void 0:n.length){var i,r=null===(i=e.createReview)||void 0===i?void 0:i.errors.map((function(e){return null===e||void 0===e?void 0:e.text}));Object(b.d)({type:"error",message:"".concat(r.toString())})}else Object(b.d)({type:"success",message:"Recensione creata con successo"})},onError:function(e){return Object(b.d)({type:"error",message:e.message})}}),l=Object(i.a)(c,2),s=l[0],d=l[1].loading;return Object(h.jsx)(r.a,{disabled:n||d,"aria-label":"review",onClick:function(){a&&a(),s({variables:{review:t}})},color:"primary",children:"Recensisci"})},O={.5:"Useless",1:"Useless+",1.5:"Poor",2:"Poor+",2.5:"Ok",3:"Ok+",3.5:"Good",4:"Good+",4.5:"Excellent",5:"Excellent+"},p=function(e){var t=e.idUser,n=e.idNegotiation,b=e.type,p=e.isMessage,g=a.useState(!1),x=Object(i.a)(g,2),m=x[0],y=x[1],C=a.useState(2),w=Object(i.a)(C,2),k=w[0],S=w[1],N=a.useState(-1),A=Object(i.a)(N,2),T=A[0],B=A[1],E=a.useState(""),M=Object(i.a)(E,2),L=M[0],R=M[1],D=Object(c.c)(),I=Object(c.d)(),_=Object(c.b)(),F=function(){y(!1)};return b=p?o.i.Sell:b,Object(h.jsxs)(h.Fragment,{children:[Object(h.jsx)(r.a,{fullWidth:!0,"aria-label":"review",className:b===o.i.Buy?D.buyButton:D.sellButton,onClick:function(){y(!0)},children:"Lascia una recensione"}),Object(h.jsx)("div",{style:{display:"none"},children:Object(h.jsxs)(s.a,{open:m,onClose:F,"aria-labelledby":"form-dialog-title",children:[Object(h.jsx)(j.a,{id:"form-dialog-title",children:"Recensisci la trattativa"}),Object(h.jsxs)(d.a,{children:[Object(h.jsxs)("div",{className:_.root,children:[Object(h.jsx)(c.a,{name:"hover-feedback",value:k,precision:.5,onChange:function(e,t){S(t)},onChangeActive:function(e,t){B(t)}}),null!==k&&Object(h.jsx)(l.a,{ml:2,children:O[-1!==T?T:k]})]}),Object(h.jsx)(v.a,{color:"primary",multiline:!0,rows:4,value:L,error:L.length>0&&L.length<=5,helperText:"Lunghezza minima 5 caratteri",onChange:function(e){R(e.target.value)},InputLabelProps:{style:{color:"#6d1331"}},InputProps:{className:I.inputSell,classes:{underline:I.underlineSell}},id:"outlined-multiline-flexible",label:"Recensione",placeholder:"Ottima persona con cui...."})]}),Object(h.jsxs)(u.a,{children:[Object(h.jsx)(r.a,{"aria-label":"close-modal",onClick:F,color:"primary",children:"Cancel"}),Object(h.jsx)(f,{disabled:L.length<=5,review:{forUser:t,rating:k,negotiation:n,content:L,type:b},closeModal:F})]})]})})]})}},491:function(e,t,n){"use strict";n.d(t,"b",(function(){return O})),n.d(t,"a",(function(){return p}));var i=n(31),r=n(23),a=n(0),o=n(458),c=n(516),l=n(500),s=n.n(l),d=n(462),u=n(515),v=n(563),j=n(6),b=n(550),h=n(18);var f=n(3),O=Object(j.a)({root:{color:b.a[400],"&$checked":{color:b.a[600]}},checked:{}})((function(e){return Object(f.jsx)(v.a,Object(r.a)({color:"default"},e))})),p=function(e){var t=Object(h.e)(),n=a.useState(!1),r=Object(i.a)(n,2),l=r[0],v=r[1],j=a.useState(!1),b=Object(i.a)(j,2),p=b[0],g=b[1],x=a.useState({priceTo:function(e){return e<=(null===t||void 0===t?void 0:t.priceTo)},abv:function(e){return e>=(null===t||void 0===t?void 0:t.abv)-.5||e<=(null===t||void 0===t?void 0:t.abv)+.5},harvest:function(e){return e===(null===t||void 0===t?void 0:t.harvest)||e-1===(null===t||void 0===t?void 0:t.harvest)},litersTo:function(e){return e>=(null===t||void 0===t?void 0:t.litersTo)}}),m=Object(i.a)(x,2),y=m[0],C=m[1];a.useEffect((function(){if(e.list.length>0){var t=function(e,t){var n=Object.keys(t);return e.filter((function(e){return n.every((function(n){return"function"!==typeof t[n]||t[n](e[n])}))}))}(e.list,y);e.setFilteredList(t)}}),[y,e.list]);return Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)(o.a,{onClick:function(){return g(!p)},"aria-label":"filter",color:"primary",size:"large",startIcon:Object(f.jsx)(s.a,{}),children:"Filtri"}),Object(f.jsxs)(c.a,{in:p,children:[e.children,Object(f.jsx)(d.a,{}),Object(f.jsx)(u.a,{control:Object(f.jsx)(O,{checked:l,onChange:function(){C(l?{priceTo:function(e){return e<=(null===t||void 0===t?void 0:t.priceTo)},abv:function(e){return e>=(null===t||void 0===t?void 0:t.abv)-.5||e<=(null===t||void 0===t?void 0:t.abv)+.5},harvest:function(e){return e===(null===t||void 0===t?void 0:t.harvest)||e-1===(null===t||void 0===t?void 0:t.harvest)},litersTo:function(e){return e>=(null===t||void 0===t?void 0:t.litersTo)}}:{priceTo:function(){return!0},harvest:function(){return!0},abv:function(){return!0},litersTo:function(){return!0}}),v(!l)},name:"showAll"}),label:"Mostra tutti gli annunci per questo vino"})]})]})}},494:function(e,t,n){"use strict";var i=n(1),r=n(4),a=n(0),o=(n(8),n(5)),c=n(6),l=n(94),s=a.forwardRef((function(e,t){var n=e.children,c=e.classes,s=e.className,d=e.disableTypography,u=void 0!==d&&d,v=Object(r.a)(e,["children","classes","className","disableTypography"]);return a.createElement("div",Object(i.a)({className:Object(o.a)(c.root,s),ref:t},v),u?n:a.createElement(l.a,{component:"h2",variant:"h6"},n))}));t.a=Object(c.a)({root:{margin:0,padding:"16px 24px",flex:"0 0 auto"}},{name:"MuiDialogTitle"})(s)},565:function(e,t,n){"use strict";n.r(t);var i=n(55),r=n.n(i),a=n(81),o=n(31),c=n(0),l=n(94),s=n(455),d=n(470),u=n(13),v=n(461),j=n(42),b=n(458),h=n(37),f=n(498),O=n(482),p=n(140),g=n(487),x=n(18),m=n(486),y=n(3),C=function(e){var t,n=e.negotiation,i=Object(x.c)(),r=Object(p.c)(),a=Object(h.a)(),o=Object(f.a)(a.breakpoints.up("sm"))?400:250,c=n.type===u.i.Buy,s=-1!==(null===(t=n.review)||void 0===t?void 0:t.findIndex((function(e){return(null===e||void 0===e?void 0:e.createdBy._id)===(null===i||void 0===i?void 0:i._id)})));return Object(y.jsxs)(O.a,{width:o,typeAd:n.type,children:[Object(y.jsxs)(v.a,{"aria-label":"link-negotiation",component:j.a,to:"/trattative/".concat(n._id),style:{textDecoration:"none"},children:[Object(y.jsxs)(l.a,{component:"h5",variant:"h6",color:c?"textSecondary":"primary",children:[c?"Compro":"Vendo"," ","AdWine"===n.ad.__typename&&n.ad.wineName," "]}),Object(y.jsxs)(l.a,{align:"left",variant:"body1",color:c?"textSecondary":"primary",children:["Aperta da: cantina ",n.createdBy.firstName,Object(y.jsx)("br",{}),"Per cantina: ",n.forUserAd.firstName,Object(y.jsx)("br",{}),n.isConcluded?"Trattativa conclusa":null]}),Object(y.jsx)("br",{})]}),Object(y.jsxs)(l.a,{"data-testid":"published",align:"right",variant:"caption",color:c?"textSecondary":"primary",children:["Trattativa aperta: ",n.dateCreated]}),n.isConcluded?Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)("br",{}),Object(y.jsxs)(l.a,{align:"right",variant:"caption",color:c?"textSecondary":"primary",children:["Trattativa conclusa: ",n.dateConcluded]})]}):null,Object(y.jsxs)("div",{children:[Object(y.jsx)("br",{}),n.isConcluded?s?null:Object(y.jsx)(g.a,{idNegotiation:n._id,type:n.type,idUser:n.forUserAd._id}):Object(y.jsx)(m.a,{isBuy:c,id:n._id}),Object(y.jsx)(b.a,{style:{marginTop:5},fullWidth:!0,className:c?r.buyButton:r.sellButton,color:"primary",component:j.a,to:"/messaggi/".concat(n._id),children:"Apri la chat"})]})]})},w=n(480),k=n(485),S=n(484),N=n(491),A=n(515),T=n(462),B=n(164);t.default=function(){var e,t,n,i,v,j,b,h=c.useState(u.h.CreatedAtDesc),f=Object(o.a)(h,2),O=f[0],p=f[1],g=Object(u.H)({variables:{offset:0,limit:4,orderBy:O,isConcluded:!1},onError:function(e){return console.error(e)}}),m=g.data,E=g.loading,M=g.error,L=g.fetchMore,R=c.useState(!1),D=Object(o.a)(R,2),I=D[0],_=D[1],F=c.useState(!1),P=Object(o.a)(F,2),U=P[0],W=P[1],z=c.useState(!1),V=Object(o.a)(z,2),G=V[0],J=V[1],q=function(){var e=Object(a.a)(r.a.mark((function e(){var t,n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!I){e.next=3;break}return _(!I),e.abrupt("return");case 3:if(J(!0),!L||I){e.next=15;break}return e.prev=5,_(!0),e.next=9,L({variables:{limit:null===m||void 0===m||null===(t=m.negotiations)||void 0===t||null===(n=t.negotiations)||void 0===n?void 0:n.length,isConcluded:!0}});case 9:J(!1),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(5),Object(x.d)({type:"error",message:"Errore durante il caricamento delle trattative"});case 15:case"end":return e.stop()}}),e,null,[[5,12]])})));return function(){return e.apply(this,arguments)}}(),H=(null===m||void 0===m||null===(e=m.negotiations)||void 0===e||null===(t=e.negotiations)||void 0===t?void 0:t.length)<(null===m||void 0===m||null===(n=m.negotiations)||void 0===n?void 0:n.pageCount);if(c.useEffect((function(){var e,t,n,i;(null===m||void 0===m||null===(e=m.negotiations)||void 0===e||null===(t=e.negotiations)||void 0===t?void 0:t.length)&&L&&(J(!0),L({variables:{orderBy:O,limit:null===m||void 0===m||null===(n=m.negotiations)||void 0===n||null===(i=n.negotiations)||void 0===i?void 0:i.length,isConcluded:I}}).then((function(){J(!1)})).catch((function(e){J(!1),console.error(e)})))}),[O]),E)return Object(y.jsx)(B.a,{});if(M)return Object(y.jsx)("div",{children:M.message});if(0===(null===m||void 0===m||null===(i=m.negotiations)||void 0===i||null===(v=i.negotiations)||void 0===v?void 0:v.length))return Object(y.jsx)("div",{children:"Non hai trattative attive"});if(null===m||void 0===m||null===(j=m.negotiations)||void 0===j||null===(b=j.negotiations)||void 0===b?void 0:b.length){var $,K=function(){var e=Object(a.a)(r.a.mark((function e(){var t,n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(W(!0),!L){e.next=12;break}return e.prev=2,e.next=5,L({variables:{offset:null===m||void 0===m||null===(t=m.negotiations)||void 0===t||null===(n=t.negotiations)||void 0===n?void 0:n.length,orderBy:O,isConcluded:I}});case 5:W(!1),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(2),console.error(e.t0),W(!1);case 12:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(){return e.apply(this,arguments)}}();return Object(y.jsxs)(d.a,{component:"main",maxWidth:"xs",children:[Object(y.jsx)(s.a,{}),Object(y.jsx)(w.a,{}),Object(y.jsx)("br",{}),Object(y.jsx)(l.a,{color:"primary",component:"h3",variant:"h5",children:"Le tue trattative attive"}),Object(y.jsx)("br",{}),Object(y.jsx)(k.a,{setOrder:p,order:O}),Object(y.jsx)(T.a,{}),Object(y.jsx)(A.a,{control:Object(y.jsx)(N.b,{checked:I,onChange:q,name:"showAll"}),label:"Mostra anche le trattative chiuse"}),G?Object(y.jsx)(B.a,{}):Object(y.jsx)(S.a,{fetchMore:K,isVisible:H,isLoading:U,children:null===m||void 0===m||null===($=m.negotiations)||void 0===$?void 0:$.negotiations.filter((function(e){return I?e:(null===e||void 0===e?void 0:e.isConcluded)===I})).map((function(e){return Object(y.jsx)(C,{negotiation:e},null===e||void 0===e?void 0:e._id)}))})]})}return Object(y.jsx)("div",{children:"Grave errore"})}}}]);