(this["webpackJsonpwine-app-frontend"]=this["webpackJsonpwine-app-frontend"]||[]).push([[12],{456:function(e,t,n){"use strict";var i=n(46),o=n(47);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=o(n(0)),r=(0,i(n(48)).default)(a.createElement("path",{d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore");t.default=r},457:function(e,t,n){"use strict";n.d(t,"a",(function(){return b}));var i=n(4),o=n(26),a=n(41),r=n(0),s=n(456),l=n.n(s),c=n(131),d=n(232),u=n(384),v=Object(c.a)((function(){return Object(d.a)({root:{display:"flex",flexDirection:"column",alignItems:"center"}})})),b=function(e){var t=v(),n="messaggi"===Object(a.d)().pathname.split("/")[1],s=function(e){var t=e.root,n=void 0===t?null:t,i=e.rootMargin,a=void 0===i?"0px":i,s=e.threshold,l=void 0===s?0:s,c=r.useState(null),d=Object(o.a)(c,2),u=d[0],v=d[1],b=r.useState(null),j=Object(o.a)(b,2),g=j[0],f=j[1],h=r.useRef(null);return r.useEffect((function(){h.current&&h.current.disconnect(),h.current=new window.IntersectionObserver((function(e){var t=Object(o.a)(e,1)[0];return v(t)}),{root:n,rootMargin:a,threshold:l});var e=h.current;return g&&e.observe(g),function(){return e.disconnect()}}),[g,n,a,l]),[f,u]}({threshold:0}),c=Object(o.a)(s,2),d=c[0],b=c[1],j=r.useState(!0),g=Object(o.a)(j,2),f=g[0],h=g[1];return r.useEffect((function(){b&&(null===b||void 0===b?void 0:b.intersectionRatio)>=.5&&f?(e.fetchMore(),e.setIsLoading&&e.setIsLoading(!0),h(!1)):0!==(null===b||void 0===b?void 0:b.intersectionRatio)||f||(h(!0),e.setIsLoading&&e.setIsLoading(!1))}),[null===b||void 0===b?void 0:b.intersectionRatio]),n?Object(i.jsxs)(i.Fragment,{children:[e.isVisible?Object(i.jsxs)("div",{className:t.root,id:"page-bottom-boundary",ref:d,children:[" ",Object(i.jsx)(l.a,{})]}):null,e.children]}):Object(i.jsxs)("div",{className:t.root,children:[e.children,e.isVisible?e.isLoading?Object(i.jsx)(u.a,{}):Object(i.jsxs)("div",{id:"page-bottom-boundary",ref:d,style:{height:30},children:[" ",Object(i.jsx)(l.a,{})]}):null]})}},459:function(e,t,n){"use strict";n.d(t,"a",(function(){return v}));var i=n(4),o=n(81),a=n.n(o),r=n(104),s=n(26),l=n(439),c=(n(0),n(23)),d=n(15),u=n(132),v=function(e){var t=e.id,n=e.isBuy,o=Object(u.c)(),v=Object(d.L)({onCompleted:function(e){var t,n;if(null===(t=e.updateNegotiation)||void 0===t||null===(n=t.errors)||void 0===n?void 0:n.length){var i,o=null===(i=e.updateNegotiation)||void 0===i?void 0:i.errors.map((function(e){return null===e||void 0===e?void 0:e.text}));Object(c.d)({type:"error",message:"".concat(o.toString())})}else Object(c.d)({message:"trattativa chiusa con successo",type:"success"})},onError:function(e){return Object(c.d)({type:"error",message:e.message})}}),b=Object(s.a)(v,2),j=b[0],g=b[1].loading,f=function(){var e=Object(r.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j({variables:{negotiation:{_id:t,isConcluded:!0}}});case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(i.jsx)(l.a,{"aria-label":"close-negotiation",className:n?o.buyButton:o.sellButton,disabled:g,onClick:f,children:"Dichiara chiusa la trattativa"})}},462:function(e,t,n){"use strict";n.d(t,"a",(function(){return N}));var i=n(4),o=n(26),a=n(439),r=n(0),s=n(15),l=n(132),c=n(448),d=n(441),u=n(442),v=n(443),b=n(381),j=n(1),g=n(5),f=(n(10),n(7)),h=n(8),p=n(90),m=r.forwardRef((function(e,t){var n=e.children,i=e.classes,o=e.className,a=e.disableTypography,s=void 0!==a&&a,l=Object(g.a)(e,["children","classes","className","disableTypography"]);return r.createElement("div",Object(j.a)({className:Object(f.a)(i.root,o),ref:t},l),s?n:r.createElement(p.a,{component:"h2",variant:"h6"},n))})),O=Object(h.a)({root:{margin:0,padding:"16px 24px",flex:"0 0 auto"}},{name:"MuiDialogTitle"})(m),x=n(23),y=function(e){var t=e.review,n=e.disabled,r=e.closeModal,l=Object(s.t)({onCompleted:function(e){var t,n;if(null===(t=e.createReview)||void 0===t||null===(n=t.errors)||void 0===n?void 0:n.length){var i,o=null===(i=e.createReview)||void 0===i?void 0:i.errors.map((function(e){return null===e||void 0===e?void 0:e.text}));Object(x.d)({type:"error",message:"".concat(o.toString())})}else Object(x.d)({type:"success",message:"Recensione creata con successo"})},onError:function(e){return Object(x.d)({type:"error",message:e.message})}}),c=Object(o.a)(l,2),d=c[0],u=c[1].loading;return Object(i.jsx)(a.a,{disabled:n||u,"aria-label":"review",onClick:function(){r&&r(),d({variables:{review:t}})},color:"primary",children:"Recensisci"})},w={.5:"Useless",1:"Useless+",1.5:"Poor",2:"Poor+",2.5:"Ok",3:"Ok+",3.5:"Good",4:"Good+",4.5:"Excellent",5:"Excellent+"},N=function(e){var t=e.idUser,n=e.idNegotiation,j=e.type,g=r.useState(!1),f=Object(o.a)(g,2),h=f[0],p=f[1],m=r.useState(2),x=Object(o.a)(m,2),N=x[0],C=x[1],M=r.useState(-1),R=Object(o.a)(M,2),k=R[0],S=R[1],L=r.useState(""),E=Object(o.a)(L,2),_=E[0],F=E[1],B=Object(l.c)(),T=Object(l.d)(),I=Object(l.b)(),P=function(){p(!1)};return Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)(a.a,{"aria-label":"review",className:j===s.k.Buy?B.buyButton:B.sellButton,onClick:function(){p(!0)},children:"Lascia una recensione"}),Object(i.jsx)("div",{style:{display:"none"},children:Object(i.jsxs)(d.a,{open:h,onClose:P,"aria-labelledby":"form-dialog-title",children:[Object(i.jsx)(O,{id:"form-dialog-title",children:"Recensisci la trattativa"}),Object(i.jsxs)(u.a,{children:[Object(i.jsxs)("div",{className:I.root,children:[Object(i.jsx)(l.a,{name:"hover-feedback",value:N,precision:.5,onChange:function(e,t){C(t)},onChangeActive:function(e,t){S(t)}}),null!==N&&Object(i.jsx)(c.a,{ml:2,children:w[-1!==k?k:N]})]}),Object(i.jsx)(b.a,{color:"primary",multiline:!0,rows:4,value:_,error:_.length>0&&_.length<=5,helperText:"Lunghezza minima 5 caratteri",onChange:function(e){F(e.target.value)},InputLabelProps:{style:{color:"#6d1331"}},InputProps:{className:T.inputSell,classes:{underline:T.underlineSell}},id:"outlined-multiline-flexible",label:"Recensione",placeholder:"Ottima persona con cui...."})]}),Object(i.jsxs)(v.a,{children:[Object(i.jsx)(a.a,{"aria-label":"close-modal",onClick:P,color:"primary",children:"Cancel"}),Object(i.jsx)(y,{disabled:_.length<=5,review:{forUser:t,rating:N,negotiation:n,content:_,type:j},closeModal:P})]})]})})]})}},489:function(e,t,n){"use strict";var i=n(46),o=n(47);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=o(n(0)),r=(0,i(n(48)).default)(a.createElement("path",{d:"M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"}),"Send");t.default=r},511:function(e,t,n){"use strict";n.r(t);var i=n(4),o=n(81),a=n.n(o),r=n(104),s=n(45),l=n(26),c=n(0),d=n(438),u=n(437),v=n(15),b=n(41),j=n(23),g=n(381),f=n(90),h=n(448),p=n(440),m=function(e){var t=e.message;if(!t)return null;var n=Object(j.c)(),o=t.sentBy._id===(null===n||void 0===n?void 0:n._id),a=o?12:0,r=o?0:12;return Object(i.jsx)(h.a,{"data-testid":"message-box",display:"flex",flexDirection:o?"row-reverse":"row",p:1,m:1,children:Object(i.jsxs)(h.a,{p:1,color:"white",bgcolor:o?"#6d1331":"#707070",style:{borderBottomLeftRadius:12,borderBottomRightRadius:12,borderTopRightRadius:r,borderTopLeftRadius:a},children:[Object(i.jsx)(f.a,{variant:"body1",children:t.content}),Object(i.jsx)(p.a,{container:!0,justify:"flex-end",children:Object(i.jsx)(f.a,{align:"right",variant:"caption",children:t.dateSent})})]})})},O=n(489),x=n.n(O),y=n(383),w=n(380),N=n(457),C=n(459),M=n(462),R=function(e){var t,n=e.propsMessage,o=Object(j.c)(),a=c.useState(""),r=Object(l.a)(a,2),s=r[0],d=r[1],u=c.useState(!1),v=Object(l.a)(u,2),b=v[0],f=v[1],h=c.useState(!0),p=Object(l.a)(h,2),O=p[0],R=p[1],k=c.useRef(null),S=c.useRef(),L=setTimeout((function(){R(!1),S.current=L}));c.useEffect((function(){var e=S.current;return function(){clearTimeout(e)}}),[]),c.useEffect((function(){if(k.current){if(b)return;k.current.scroll({top:document.body.offsetHeight+1e6,left:0,behavior:"smooth"})}}),[n.messages]);var E=n.messages?n.messages[0]:null;if(!E)return null;var _=E.sentBy._id===(null===o||void 0===o?void 0:o._id)?E.sentTo._id:E.sentBy._id;return n.messages?Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)("div",{style:{height:"75vh",margin:0,padding:0,overflowY:"scroll"},ref:k,children:Object(i.jsx)(N.a,{fetchMore:n.handleFetchMore,isLoading:b,isVisible:n.isVisible&&!O,setIsLoading:f,children:null===(t=n.messages)||void 0===t?void 0:t.map((function(e){return Object(i.jsx)(m,{message:e},null===e||void 0===e?void 0:e._id)}))})}),Object(i.jsx)("hr",{style:{borderWidth:1,borderColor:"#6d1331"}}),Object(i.jsxs)("div",{style:{height:"10vh",backgroundColor:"#fff",paddingTop:0},children:[E.negotiation.isConcluded?Object(i.jsx)(M.a,{idNegotiation:E.negotiation._id,idUser:_,type:E.negotiation.type}):Object(i.jsx)(C.a,{id:E.negotiation._id}),Object(i.jsx)(g.a,{fullWidth:!0,multiline:!0,rowsMax:2,variant:"outlined",name:"content",type:"text",placeholder:"",label:"",value:s,onChange:function(e){d(e.target.value)},inputProps:{"aria-label":"input-message"},InputProps:{endAdornment:Object(i.jsx)(y.a,{position:"end",children:Object(i.jsx)(w.a,{"aria-label":"send",disabled:!s,onClick:function(){var e={content:s,sentTo:_,negotiation:E.negotiation._id};n.handleCreate(e),d("")},children:Object(i.jsx)(x.a,{})})})}})]})]}):null},k=n(154);t.default=function(){var e,t,n,o,g,f,h,p,m=Object(b.e)().id,O=Object(v.A)({fetchPolicy:"network-only",variables:{id:m,offset:0,limit:20}}),x=O.data,y=O.loading,w=O.error,N=O.fetchMore,C=c.useState([]),M=Object(l.a)(C,2),S=M[0],L=M[1],E=(null===x||void 0===x||null===(e=x.messagesForNegotiation)||void 0===e||null===(t=e.messages)||void 0===t?void 0:t.length)?null===x||void 0===x?void 0:x.messagesForNegotiation.messages[0]:null,_=Object(v.r)({onError:function(e){console.log(e),Object(j.d)({type:"error",message:e.message})},onCompleted:function(e){var t,n,i,o=null===e||void 0===e||null===(t=e.createMessage)||void 0===t?void 0:t.response;if(null===(n=e.createMessage)||void 0===n||null===(i=n.errors)||void 0===i?void 0:i.length){var a,r=null===(a=e.createMessage)||void 0===a?void 0:a.errors.map((function(e){return null===e||void 0===e?void 0:e.text}));Object(j.d)({type:"error",message:"".concat(r.toString())})}else(null===S||void 0===S?void 0:S.length)&&L([].concat(Object(s.a)(S),[o]))}}),F=Object(l.a)(_,1)[0];c.useEffect((function(){var e,t;(null===x||void 0===x||null===(e=x.messagesForNegotiation)||void 0===e?void 0:e.messages)&&L(Object(s.a)(null===x||void 0===x||null===(t=x.messagesForNegotiation)||void 0===t?void 0:t.messages).reverse())}),[null===x||void 0===x||null===(n=x.messagesForNegotiation)||void 0===n?void 0:n.messages]);var B=function(){var e=Object(r.a)(a.a.mark((function e(){var t,n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!N){e.next=9;break}return e.prev=1,e.next=4,N({variables:{offset:null===x||void 0===x||null===(t=x.messagesForNegotiation)||void 0===t||null===(n=t.messages)||void 0===n?void 0:n.length}});case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),console.log(e.t0);case 9:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(){return e.apply(this,arguments)}}(),T=function(){var e=Object(r.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F({variables:{message:t}});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),I={isLoading:y,messages:S,isVisible:(null===x||void 0===x||null===(o=x.messagesForNegotiation)||void 0===o||null===(g=o.messages)||void 0===g?void 0:g.length)!==(null===x||void 0===x||null===(f=x.messagesForNegotiation)||void 0===f?void 0:f.pageCount),handleCreate:T,handleFetchMore:B};return y||void 0===I.isVisible?Object(i.jsx)(k.a,{}):w?Object(i.jsx)("div",{children:"error"}):E?(null===x||void 0===x||null===(h=x.messagesForNegotiation)||void 0===h||null===(p=h.messages)||void 0===p?void 0:p.length)?Object(i.jsxs)(u.a,{component:"main",maxWidth:"sm",children:[Object(i.jsx)(d.a,{}),Object(i.jsx)(R,{propsMessage:I})]}):null:Object(i.jsx)("div",{children:"niente mess ancora"})}}}]);
//# sourceMappingURL=12.d85f4c33.chunk.js.map