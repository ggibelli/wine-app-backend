(this["webpackJsonpwine-app-frontend"]=this["webpackJsonpwine-app-frontend"]||[]).push([[13],{457:function(e,t,n){"use strict";var i=n(53),a=n(54);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=a(n(0)),r=(0,i(n(55)).default)(o.createElement("path",{d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore");t.default=r},458:function(e,t,n){"use strict";n.d(t,"a",(function(){return b}));var i=n(4),a=n(28),o=n(41),r=n(0),s=n(457),l=n.n(s),c=n(131),d=n(233),u=n(384),v=Object(c.a)((function(){return Object(d.a)({root:{display:"flex",flexDirection:"column",alignItems:"center"}})})),b=function(e){var t=v(),n="messaggi"===Object(o.d)().pathname.split("/")[1],s=function(e){var t=e.root,n=void 0===t?null:t,i=e.rootMargin,o=void 0===i?"0px":i,s=e.threshold,l=void 0===s?0:s,c=r.useState(null),d=Object(a.a)(c,2),u=d[0],v=d[1],b=r.useState(null),j=Object(a.a)(b,2),g=j[0],f=j[1],h=r.useRef(null);return r.useEffect((function(){h.current&&h.current.disconnect(),h.current=new window.IntersectionObserver((function(e){var t=Object(a.a)(e,1)[0];return v(t)}),{root:n,rootMargin:o,threshold:l});var e=h.current;return g&&e.observe(g),function(){return e.disconnect()}}),[g,n,o,l]),[f,u]}({threshold:0}),c=Object(a.a)(s,2),d=c[0],b=c[1],j=r.useState(!0),g=Object(a.a)(j,2),f=g[0],h=g[1];return r.useEffect((function(){b&&(null===b||void 0===b?void 0:b.intersectionRatio)>0&&f?(e.fetchMore(),e.setIsLoading&&e.setIsLoading(!0),h(!1)):0!==(null===b||void 0===b?void 0:b.intersectionRatio)||f||(h(!0),e.setIsLoading&&e.setIsLoading(!1))}),[null===b||void 0===b?void 0:b.intersectionRatio]),n?Object(i.jsxs)(i.Fragment,{children:[e.isVisible?e.isLoading?Object(i.jsx)("div",{className:t.root,children:Object(i.jsx)(u.a,{})}):Object(i.jsxs)("div",{className:t.root,id:"page-bottom-boundary",ref:d,children:[" ",Object(i.jsx)(l.a,{})]}):null,e.children]}):Object(i.jsxs)("div",{className:t.root,children:[e.children,e.isVisible?e.isLoading?Object(i.jsx)(u.a,{}):Object(i.jsxs)("div",{id:"page-bottom-boundary",ref:d,style:{height:30},children:[" ",Object(i.jsx)(l.a,{})]}):null]})}},460:function(e,t,n){"use strict";n.d(t,"a",(function(){return v}));var i=n(4),a=n(56),o=n.n(a),r=n(82),s=n(28),l=n(439),c=(n(0),n(21)),d=n(14),u=n(133),v=function(e){var t=e.id,n=e.isBuy,a=Object(u.c)(),v=Object(d.O)({onCompleted:function(e){var t,n;if(null===(t=e.updateNegotiation)||void 0===t||null===(n=t.errors)||void 0===n?void 0:n.length){var i,a=null===(i=e.updateNegotiation)||void 0===i?void 0:i.errors.map((function(e){return null===e||void 0===e?void 0:e.text}));Object(c.d)({type:"error",message:"".concat(a.toString())})}else Object(c.d)({message:"trattativa chiusa con successo",type:"success"})},onError:function(e){return Object(c.d)({type:"error",message:e.message})}}),b=Object(s.a)(v,2),j=b[0],g=b[1].loading,f=function(){var e=Object(r.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j({variables:{negotiation:{_id:t,isConcluded:!0}}});case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(i.jsx)(l.a,{"aria-label":"close-negotiation",className:n?a.buyButton:a.sellButton,disabled:g,onClick:f,children:"Dichiara chiusa la trattativa"})}},461:function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));var i=n(4),a=n(28),o=n(439),r=n(0),s=n(14),l=n(133),c=n(449),d=n(441),u=n(442),v=n(443),b=n(381),j=n(467),g=n(21),f=function(e){var t=e.review,n=e.disabled,r=e.closeModal,l=Object(s.u)({onCompleted:function(e){var t,n;if(null===(t=e.createReview)||void 0===t||null===(n=t.errors)||void 0===n?void 0:n.length){var i,a=null===(i=e.createReview)||void 0===i?void 0:i.errors.map((function(e){return null===e||void 0===e?void 0:e.text}));Object(g.d)({type:"error",message:"".concat(a.toString())})}else Object(g.d)({type:"success",message:"Recensione creata con successo"})},onError:function(e){return Object(g.d)({type:"error",message:e.message})}}),c=Object(a.a)(l,2),d=c[0],u=c[1].loading;return Object(i.jsx)(o.a,{disabled:n||u,"aria-label":"review",onClick:function(){r&&r(),d({variables:{review:t}})},color:"primary",children:"Recensisci"})},h={.5:"Useless",1:"Useless+",1.5:"Poor",2:"Poor+",2.5:"Ok",3:"Ok+",3.5:"Good",4:"Good+",4.5:"Excellent",5:"Excellent+"},p=function(e){var t=e.idUser,n=e.idNegotiation,g=e.type,p=r.useState(!1),O=Object(a.a)(p,2),m=O[0],x=O[1],y=r.useState(2),w=Object(a.a)(y,2),C=w[0],N=w[1],M=r.useState(-1),S=Object(a.a)(M,2),k=S[0],R=S[1],L=r.useState(""),_=Object(a.a)(L,2),E=_[0],F=_[1],B=Object(l.c)(),I=Object(l.d)(),P=Object(l.b)(),T=function(){x(!1)};return Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)(o.a,{"aria-label":"review",className:g===s.l.Buy?B.buyButton:B.sellButton,onClick:function(){x(!0)},children:"Lascia una recensione"}),Object(i.jsx)("div",{style:{display:"none"},children:Object(i.jsxs)(d.a,{open:m,onClose:T,"aria-labelledby":"form-dialog-title",children:[Object(i.jsx)(j.a,{id:"form-dialog-title",children:"Recensisci la trattativa"}),Object(i.jsxs)(u.a,{children:[Object(i.jsxs)("div",{className:P.root,children:[Object(i.jsx)(l.a,{name:"hover-feedback",value:C,precision:.5,onChange:function(e,t){N(t)},onChangeActive:function(e,t){R(t)}}),null!==C&&Object(i.jsx)(c.a,{ml:2,children:h[-1!==k?k:C]})]}),Object(i.jsx)(b.a,{color:"primary",multiline:!0,rows:4,value:E,error:E.length>0&&E.length<=5,helperText:"Lunghezza minima 5 caratteri",onChange:function(e){F(e.target.value)},InputLabelProps:{style:{color:"#6d1331"}},InputProps:{className:I.inputSell,classes:{underline:I.underlineSell}},id:"outlined-multiline-flexible",label:"Recensione",placeholder:"Ottima persona con cui...."})]}),Object(i.jsxs)(v.a,{children:[Object(i.jsx)(o.a,{"aria-label":"close-modal",onClick:T,color:"primary",children:"Cancel"}),Object(i.jsx)(f,{disabled:E.length<=5,review:{forUser:t,rating:C,negotiation:n,content:E,type:g},closeModal:T})]})]})})]})}},467:function(e,t,n){"use strict";var i=n(1),a=n(5),o=n(0),r=(n(10),n(7)),s=n(8),l=n(91),c=o.forwardRef((function(e,t){var n=e.children,s=e.classes,c=e.className,d=e.disableTypography,u=void 0!==d&&d,v=Object(a.a)(e,["children","classes","className","disableTypography"]);return o.createElement("div",Object(i.a)({className:Object(r.a)(s.root,c),ref:t},v),u?n:o.createElement(l.a,{component:"h2",variant:"h6"},n))}));t.a=Object(s.a)({root:{margin:0,padding:"16px 24px",flex:"0 0 auto"}},{name:"MuiDialogTitle"})(c)},515:function(e,t,n){"use strict";var i=n(53),a=n(54);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=a(n(0)),r=(0,i(n(55)).default)(o.createElement("path",{d:"M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"}),"Send");t.default=r},543:function(e,t,n){"use strict";n.r(t);var i=n(4),a=n(56),o=n.n(a),r=n(82),s=n(28),l=n(45),c=n(0),d=n(438),u=n(437),v=n(14),b=n(41),j=n(21),g=n(381),f=n(91),h=n(449),p=n(440),O=function(e){var t=e.message;if(!t)return null;var n=Object(j.c)(),a=t.sentBy._id===(null===n||void 0===n?void 0:n._id),o=a?12:0,r=a?0:12;return Object(i.jsx)(h.a,{"data-testid":"message-box",display:"flex",flexDirection:a?"row-reverse":"row",p:1,m:1,children:Object(i.jsxs)(h.a,{p:1,color:"white",bgcolor:a?"#6d1331":"#707070",style:{borderBottomLeftRadius:12,borderBottomRightRadius:12,borderTopRightRadius:r,borderTopLeftRadius:o},children:[Object(i.jsx)(f.a,{variant:"body1",children:t.content}),Object(i.jsx)(p.a,{container:!0,justify:"flex-end",children:Object(i.jsx)(f.a,{align:"right",variant:"caption",children:t.dateSent})})]})})},m=n(515),x=n.n(m),y=n(383),w=n(380),C=n(458),N=n(460),M=n(461),S=function(e){var t,n=e.propsMessage,a=Object(j.c)(),o=c.useState(""),r=Object(s.a)(o,2),l=r[0],d=r[1],u=c.useState(!1),v=Object(s.a)(u,2),b=v[0],f=v[1],h=c.useRef(null);c.useEffect((function(){if(h.current){if(b)return;h.current.scroll({top:document.body.offsetHeight+1e6,left:0,behavior:"smooth"})}return function(){}}),[n.messages]);var p=n.messages?n.messages[0]:null;if(!p)return null;var m=p.sentBy._id===(null===a||void 0===a?void 0:a._id)?p.sentTo._id:p.sentBy._id;return n.messages?Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)("div",{style:{height:"75vh",margin:0,padding:0,overflowY:"scroll"},ref:h,children:Object(i.jsx)(C.a,{fetchMore:n.handleFetchMore,isLoading:n.isLoading,isVisible:n.isVisible,setIsLoading:f,children:null===(t=n.messages)||void 0===t?void 0:t.map((function(e){return Object(i.jsx)(O,{message:e},null===e||void 0===e?void 0:e._id)}))})}),Object(i.jsx)("hr",{style:{borderWidth:1,borderColor:"#6d1331"}}),Object(i.jsxs)("div",{style:{height:"10vh",backgroundColor:"#fff",paddingTop:0},children:[p.negotiation.isConcluded?Object(i.jsx)(M.a,{idNegotiation:p.negotiation._id,idUser:m,type:p.negotiation.type}):Object(i.jsx)(N.a,{id:p.negotiation._id}),Object(i.jsx)(g.a,{fullWidth:!0,multiline:!0,rowsMax:2,variant:"outlined",name:"content",type:"text",placeholder:"",label:"",value:l,onChange:function(e){d(e.target.value)},inputProps:{"aria-label":"input-message"},InputProps:{endAdornment:Object(i.jsx)(y.a,{position:"end",children:Object(i.jsx)(w.a,{"aria-label":"send",disabled:!l,onClick:function(){var e={content:l,sentTo:m,negotiation:p.negotiation._id};n.handleCreate(e),d("")},children:Object(i.jsx)(x.a,{})})})}})]})]}):null},k=n(155);t.default=function(){var e,t,n,a,g,f,h,p=Object(b.e)().id,O=Object(v.C)({fetchPolicy:"network-only",variables:{id:p,offset:0,limit:20},onCompleted:function(e){var t=e.messagesForNegotiation;T(Object(l.a)(null===t||void 0===t?void 0:t.messages).reverse())}}),m=O.data,x=O.loading,y=O.error,w=O.fetchMore;c.useEffect((function(){var e;(null===P||void 0===P?void 0:P.length)&&T(Object(l.a)(null===m||void 0===m||null===(e=m.messagesForNegotiation)||void 0===e?void 0:e.messages).reverse())}),[m]);var C=c.useState(!0),N=Object(s.a)(C,2),M=N[0],R=N[1],L=c.useState(!1),_=Object(s.a)(L,2),E=_[0],F=_[1],B=c.useState([]),I=Object(s.a)(B,2),P=I[0],T=I[1],V=(null===m||void 0===m||null===(e=m.messagesForNegotiation)||void 0===e||null===(t=e.messages)||void 0===t?void 0:t.length)?null===m||void 0===m?void 0:m.messagesForNegotiation.messages[0]:null,U=Object(v.s)({onError:function(e){console.log(e),Object(j.d)({type:"error",message:e.message})},onCompleted:function(e){var t,n,i,a=null===e||void 0===e||null===(t=e.createMessage)||void 0===t?void 0:t.response;if(null===(n=e.createMessage)||void 0===n||null===(i=n.errors)||void 0===i?void 0:i.length){var o,r=null===(o=e.createMessage)||void 0===o?void 0:o.errors.map((function(e){return null===e||void 0===e?void 0:e.text}));Object(j.d)({type:"error",message:"".concat(r.toString())})}else(null===P||void 0===P?void 0:P.length)&&T([].concat(Object(l.a)(P),[a]))}}),z=Object(s.a)(U,1)[0],D=function(){var e=Object(r.a)(o.a.mark((function e(){var t,n,i,a,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!M){e.next=3;break}return R(!1),e.abrupt("return");case 3:if(!(null===P||void 0===P?void 0:P.length)||!w){e.next=19;break}return F(!0),e.prev=5,e.next=8,w({variables:{offset:P.length}});case 8:i=e.sent,a=i.data,r=null===(t=a.messagesForNegotiation)||void 0===t||null===(n=t.messages)||void 0===n?void 0:n.reverse(),T([].concat(Object(l.a)(r),Object(l.a)(P))),F(!1),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(5),F(!1),console.log(e.t0);case 19:case"end":return e.stop()}}),e,null,[[5,15]])})));return function(){return e.apply(this,arguments)}}(),W=function(){var e=Object(r.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,z({variables:{message:t}});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),A={isLoading:E,messages:P,isVisible:(null===m||void 0===m||null===(n=m.messagesForNegotiation)||void 0===n||null===(a=n.messages)||void 0===a?void 0:a.length)!==(null===m||void 0===m||null===(g=m.messagesForNegotiation)||void 0===g?void 0:g.pageCount),handleCreate:W,handleFetchMore:D};return x||void 0===A.isVisible?Object(i.jsx)(k.a,{}):y?Object(i.jsx)("div",{children:"error"}):V?(null===m||void 0===m||null===(f=m.messagesForNegotiation)||void 0===f||null===(h=f.messages)||void 0===h?void 0:h.length)?Object(i.jsxs)(u.a,{component:"main",maxWidth:"sm",children:[Object(i.jsx)(d.a,{}),Object(i.jsx)(S,{propsMessage:A})]}):null:Object(i.jsx)("div",{children:"niente mess ancora"})}}}]);
//# sourceMappingURL=13.42ba0b66.chunk.js.map